/*
 * File: app/view/flat/TabAppVodomer.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Osbb.view.flat.TabAppVodomer', {
    extend: 'Ext.panel.Panel',
    alias: 'widget.tabappvodomer',

    requires: [
        'Osbb.view.flat.TabAppVodomerViewModel',
        'Ext.form.Panel',
        'Ext.grid.Panel',
        'Ext.view.Table',
        'Ext.grid.column.Number',
        'Ext.grid.column.Date',
        'Ext.grid.column.Action',
        'Ext.form.FieldSet',
        'Ext.selection.CheckboxModel',
        'Ext.button.Button',
        'Ext.form.field.Date',
        'Ext.form.field.Number',
        'Ext.form.FieldContainer',
        'Ext.form.field.Display',
        'Ext.form.field.Hidden',
        'Ext.form.field.Checkbox',
        'Ext.panel.Tool'
    ],

    viewModel: {
        type: 'tabappvodomer'
    },
    id: 'tabAppVodomer',
    layout: 'fit',
    title: 'Водомеры',
    defaultListenerScope: true,

    initConfig: function(instanceConfig) {
        var me = this,
            config = {
                items: [
                    {
                        xtype: 'form',
                        id: 'fmVodomer',
                        scrollable: true,
                        bodyPadding: 10,
                        icon: '',
                        title: '',
                        items: [
                            {
                                xtype: 'container',
                                width: 1029,
                                layout: {
                                    type: 'hbox',
                                    align: 'stretch'
                                },
                                items: [
                                    {
                                        xtype: 'gridpanel',
                                        margin: 2,
                                        width: 550,
                                        collapsed: true,
                                        collapsible: true,
                                        title: 'Льготники по квартире',
                                        emptyText: 'Льготников нет',
                                        store: 'StLgotnik',
                                        columns: [
                                            {
                                                xtype: 'gridcolumn',
                                                width: 130,
                                                dataIndex: 'fio',
                                                menuDisabled: true,
                                                text: 'Ф.И.О'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                width: 148,
                                                dataIndex: 'lgota',
                                                menuDisabled: true,
                                                text: 'льгота'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 45,
                                                align: 'center',
                                                dataIndex: 'people',
                                                menuDisabled: true,
                                                text: 'чел',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                width: 40,
                                                dataIndex: 'percent',
                                                menuDisabled: true,
                                                text: '%'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 40,
                                                align: 'center',
                                                dataIndex: 'gr',
                                                menuDisabled: true,
                                                text: 'гр',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'datecolumn',
                                                width: 85,
                                                align: 'center',
                                                dataIndex: 'fdate',
                                                menuDisabled: true,
                                                text: 'дата'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                width: 45,
                                                align: 'center',
                                                dataIndex: 'vkl',
                                                menuDisabled: true,
                                                text: 'вкл'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridpanel',
                                        id: 'grAppHVodomer',
                                        margin: 2,
                                        width: 461,
                                        collapsed: true,
                                        collapsible: true,
                                        title: 'счетчики воды снятые с учета',
                                        emptyText: 'Приборов учета нет в истории',
                                        store: 'StHVodomer',
                                        columns: [
                                            {
                                                xtype: 'numbercolumn',
                                                hidden: true,
                                                dataIndex: 'address_id',
                                                text: 'Address_id'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                hidden: true,
                                                dataIndex: 'raion',
                                                text: 'House_id'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                hidden: true,
                                                dataIndex: 'period',
                                                text: 'Address'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                    metaData.style = 'color:#D10000;font-weight:bold;';
                                                    var retValue = '';
                                                    switch (value) {
                                                        case 'Хвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipex.png"/></span>';
                                                        break;
                                                        case 'Гвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeg.png"/></span>';
                                                    }
                                                    return retValue;
                                                },
                                                width: 55,
                                                align: 'center',
                                                dataIndex: 'voda',
                                                menuDisabled: true,
                                                text: 'вода'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                width: 90,
                                                dataIndex: 'place',
                                                menuDisabled: true,
                                                text: 'место'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 110,
                                                dataIndex: 'nomer',
                                                menuDisabled: true,
                                                text: 'номер',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                width: 120,
                                                dataIndex: 'model',
                                                menuDisabled: true,
                                                text: 'модель'
                                            },
                                            {
                                                xtype: 'actioncolumn',
                                                width: 40,
                                                menuDisabled: true,
                                                items: [
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            metaData = 'x-grid-center-icon';
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            // in use
                                                            var me = this;
                                                            //STORE

                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stPribor = Ext.data.StoreManager.get("StVodomer");

                                                            //LOGIN & PASSWORD

                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                address_id:values.get('address_id'),
                                                                house_id:values.get('house_id'),
                                                                what:'AVodomerBack'
                                                            };
                                                            //GRID
                                                            var store = view.getStore();
                                                            var value = store.getAt(rowIndex).data;

                                                            //LOGIKA

                                                            Ext.Object.merge(value, params);
                                                            //console.log(value);

                                                            Ext.MessageBox.confirm({
                                                                title: 'Возвращение прибора учета из истории',
                                                                msg: 'Вы возвращаете прибор учета из истории <br>Подтвердите или отмените свои действия.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.INFO,
                                                                buttonText:{
                                                                    ok:'подтвеждаю',
                                                                    cancel:'отмена'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        QueryVodomer.spisanVodomer(value,function(results){
                                                                            if (results.success==="1"){

                                                                                store.load({
                                                                                    params: {
                                                                                        what:'AppHVodomer',
                                                                                        address_id: value.address_id,
                                                                                        login:value.login,
                                                                                        password:value.password
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                                stPribor.load({
                                                                                    params: {
                                                                                        what:'AppVodomer',
                                                                                        address_id: value.address_id,
                                                                                        vodomer_id: value.vodomer_id,
                                                                                        login:value.login,
                                                                                        password:value.password
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                                Ext.MessageBox.show({
                                                                                    title: 'Возвращение прибора учета из истории',
                                                                                    msg: results.msg,
                                                                                    buttons: Ext.MessageBox.OK,
                                                                                    icon: Ext.MessageBox.INFO
                                                                                });

                                                                            } else {
                                                                                Ext.MessageBox.show({
                                                                                    title: 'Возвращение прибора учета из истории',
                                                                                    msg: results.msg,
                                                                                    buttons: Ext.MessageBox.OK,
                                                                                    icon: Ext.MessageBox.ERROR
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            });
                                                        },
                                                        icon: 'resources/css/images/ico/door_out.png',
                                                        tooltip: 'Вернуть водомер из истории'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'actioncolumn',
                                                width: 40,
                                                menuDisabled: true,
                                                items: [
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            metaData = 'x-grid-center-icon';
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            // in use
                                                            var me = this;
                                                            //STORE

                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            //LOGIN & PASSWORD

                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                address_id:values.get('address_id'),
                                                                house_id:values.get('house_id'),
                                                                what:'AVodomer'
                                                            };
                                                            //GRID
                                                            var store = view.getStore();
                                                            var value = store.getAt(rowIndex).data;

                                                            //LOGIKA

                                                            Ext.Object.merge(value, params);
                                                            //console.log(value);

                                                            Ext.MessageBox.confirm({
                                                                title: 'Удаление прибора учета безвозвратно',
                                                                msg: 'Вы безвозвратно удаляете прибор учета<br>Подтвердите или отмените свои действия.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'подтвеждаю',
                                                                    cancel:'отмена'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        QueryVodomer.delVodomer(value,function(results){
                                                                            if (results.success==="1"){

                                                                                store.load({
                                                                                    params: {
                                                                                        what:'AppHVodomer',
                                                                                        address_id: value.address_id,
                                                                                        login:value.login,
                                                                                        password:value.password
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                                // view.refresh();
                                                                                Ext.MessageBox.show({
                                                                                    title: 'Удаление прибора учета безвозвратно',
                                                                                    msg: results.msg,
                                                                                    buttons: Ext.MessageBox.OK,
                                                                                    icon: Ext.MessageBox.INFO
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            });
                                                        },
                                                        icon: 'resources/css/images/ico/no.png',
                                                        tooltip: 'Удалить водомер безвозвратно'
                                                    }
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                xtype: 'fieldset',
                                height: 465,
                                margin: 5,
                                style: 'background-color: #DCDCDC;',
                                width: 1027,
                                layout: 'absolute',
                                title: 'текущее показание счетчика',
                                items: [
                                    {
                                        xtype: 'gridpanel',
                                        x: 0,
                                        y: 35,
                                        height: 245,
                                        id: 'grAppVodomer',
                                        width: 365,
                                        title: 'Приборы учета ',
                                        store: 'StVodomer',
                                        viewConfig: {
                                            height: 163
                                        },
                                        columns: [
                                            {
                                                xtype: 'actioncolumn',
                                                width: 30,
                                                menuDisabled: true,
                                                stopSelection: false,
                                                items: [
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            metaData = 'x-grid-center-icon';
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            Ext.MessageBox.confirm({
                                                                title: 'Переброска прибора учета на другой адрес',
                                                                msg: 'Вы хотите перебросить прибор учета на другой адрес. <br>Подтвердите или отмените свои действия.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'подтвеждаю',
                                                                    cancel:'отмена'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        var dt = new Date();
                                                                        var fmAppVodomer = Ext.getCmp('fmVodomer');
                                                                        var tek = fmAppVodomer.getForm().findField('tek').getValue();
                                                                        var bt = Ext.getCmp('btAddVodomer');

                                                                        var winAddVodomer = Ext.ClassManager.instantiateByAlias('widget.winaddvodomer');
                                                                        var form = winAddVodomer.down('#fmAddVodomer');
                                                                        var stUser = Ext.data.StoreManager.get("StUser");
                                                                        var values =stUser.getAt(0);
                                                                        var value = record;//stVodomer.getAt(rowIndex).data;
                                                                        //LOGIKA'

                                                                        view.getSelectionModel().select(rowIndex);
                                                                        values.set({'vibor':'changeAppVodomer','rowind':rowIndex});
                                                                        stUser.sync();
                                                                        form.getForm().findField('tek').setFieldLabel('Текущие показания');
                                                                        //form.getForm().findField('new_address_id').hide();
                                                                        form.down('#btAddVodomer').setText('Перебросить счетчик');
                                                                        form.down('#fcntNewVodomer').hide();
                                                                        form.down('#chkExistentVod').hide();
                                                                        //form.getForm().findField('new_address_id').setValue(values.get('address_id'));
                                                                        form.loadRecord(value);
                                                                        form.getForm().findField('tek').setValue(tek);
                                                                        winAddVodomer.setTitle('Переброска прибора учета на другой адрес');
                                                                        winAddVodomer.show();


                                                                    }
                                                                }
                                                            });
                                                        },
                                                        icon: 'resources/css/images/ico/delete.png',
                                                        tooltip: 'Заменить водомер '
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                hidden: true,
                                                dataIndex: 'vodomer_id',
                                                text: 'ид',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                hidden: true,
                                                dataIndex: 'address_id',
                                                text: 'Address_id',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                hidden: true,
                                                dataIndex: 'raion',
                                                text: 'House_id'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                hidden: true,
                                                dataIndex: 'period',
                                                text: 'Address'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                    metaData.style = 'color:#D10000;font-weight:bold;';
                                                    var retValue = '';
                                                    switch (value) {
                                                        case 'Хвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipex.png"/></span>';
                                                        break;
                                                        case 'Гвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeg.png"/></span>';
                                                    }
                                                    return retValue;
                                                },
                                                width: 55,
                                                dataIndex: 'voda',
                                                menuDisabled: true,
                                                text: 'вода'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                    if (record.get('out')===1){
                                                        metaData.tdCls = 'line-through';
                                                    }
                                                    return value;
                                                },
                                                width: 80,
                                                dataIndex: 'place',
                                                menuDisabled: true,
                                                text: 'место'
                                            },
                                            {
                                                xtype: 'gridcolumn',
                                                renderer: function(value, metaData, record, rowIndex, colIndex, store, view) {
                                                    if (record.get('out')===1){
                                                        metaData.tdCls = 'line-through';
                                                    }
                                                    return value;
                                                },
                                                width: 80,
                                                dataIndex: 'nomer',
                                                menuDisabled: true,
                                                text: 'номер'
                                            },
                                            {
                                                xtype: 'actioncolumn',
                                                width: 30,
                                                menuDisabled: true,
                                                stopSelection: false,
                                                items: [
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            metaData = 'x-grid-center-icon';
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            Ext.MessageBox.confirm({
                                                                title: 'Обновление данных по прибору учета',
                                                                msg: 'Вы обновляете данные по прибору учета. <br>Подтвердите или отмените свои действия.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'подтвеждаю',
                                                                    cancel:'отмена'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        var dt = new Date();
                                                                        var fmAppVodomer = Ext.getCmp('fmVodomer');
                                                                        var tek = fmAppVodomer.getForm().findField('tek').getValue();

                                                                        var winAddVodomer = Ext.ClassManager.instantiateByAlias('widget.winaddvodomer');
                                                                        var form = winAddVodomer.down('#fmAddVodomer');
                                                                        var obrVodomer = form.down('#obrVodomer');
                                                                        var jointVodomer = form.down('#jointVodomer');
                                                                        var stUser = Ext.data.StoreManager.get("StUser");
                                                                        var values =stUser.getAt(0);
                                                                        var value = record;//stVodomer.getAt(rowIndex).data;
                                                                        //LOGIKA'
                                                                        //console.log(values.get('address_id'));
                                                                        view.getSelectionModel().select(rowIndex);
                                                                        values.set({'vibor':'editAppVodomer','rowind':rowIndex});
                                                                        stUser.sync();
                                                                        form.getForm().findField('tek').setFieldLabel('Текущие показания');

                                                                        form.down('#btAddVodomer').setText('Обновить данные');
                                                                        form.down('#chkExistentVod').hide();
                                                                        //form.getForm().findField('vd').hide();
                                                                        //jointVodomer.hide();
                                                                        form.loadRecord(value);
                                                                        form.getForm().findField('new_address_id').setValue(values.get('address_id'));
                                                                        form.getForm().findField('new_address_id').hide();
                                                                        form.getForm().findField('address_id').hide();

                                                                        form.getForm().findField('tek').setValue(tek);
                                                                        winAddVodomer.setTitle('Обновление данных по прибору учета');
                                                                        winAddVodomer.show();
                                                                    }
                                                                }
                                                            });
                                                        },
                                                        icon: 'resources/css/images/ico/edit.png',
                                                        tooltip: 'Обновить данные по водомеру'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'actioncolumn',
                                                width: 30,
                                                menuDisabled: true,
                                                items: [
                                                    {
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            // in use
                                                            var me = this;
                                                            //STORE
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stVodomer = Ext.data.StoreManager.get("StVodomer");
                                                            //LOGIN & PASSWORD
                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:'AVodomer'

                                                            };
                                                            //GRID
                                                            var grAppVodomer = Ext.getCmp('grAppVodomer');
                                                            //FORMA
                                                            var value = stVodomer.getAt(rowIndex).data;
                                                            //LOGIKA
                                                            Ext.Object.merge(value, params);
                                                            //console.log(value);
                                                            Ext.MessageBox.confirm({
                                                                title: 'Возвращение водомера из поверки (ремонта)',
                                                                msg: 'Вы возвращаете водомер из поверки (ремонта) <br>Подтвердите или отмените свои действия.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.INFO,
                                                                buttonText:{
                                                                    ok:'подтвеждаю',
                                                                    cancel:'отмена'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        QueryVodomer.outVodomerHistory(value,function(results){
                                                                            if (results.success==="1"){
                                                                                stVodomer.load({
                                                                                    params: {
                                                                                        what:'AppVodomer',
                                                                                        address_id: value.address_id,
                                                                                        vodomer_id: value.vodomer_id,
                                                                                        login:value.login,
                                                                                        password:value.password
                                                                                    },
                                                                                    callback: function(records,operation,success){
                                                                                        if(success){
                                                                                            grAppVodomer.getView().getSelectionModel().select(rowIndex);
                                                                                            Ext.MessageBox.show({
                                                                                                title: 'Возвращение cчетчика воды из поверки',
                                                                                                msg: results.msg,
                                                                                                buttons: Ext.MessageBox.OK,
                                                                                                icon: Ext.MessageBox.INFO
                                                                                            });
                                                                                        }
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            });



                                                        },
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            var out = r.get('out');
                                                            if (out === 0 ) {
                                                                metaData = 'x-hide-display';
                                                            } else if (out === 1   ){
                                                                metaData = 'x-grid-center-icon';
                                                            }
                                                            return metaData;
                                                        },
                                                        icon: 'resources/css/images/ico/door_out.png',
                                                        tooltip: 'Вернуть водомер из поверки'
                                                    },
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            //console.log(r);
                                                            var out = r.get('out');
                                                            //console.log(out);
                                                            if (out === 1 ) {
                                                                metaData = 'x-hide-display';
                                                                //console.log(1);
                                                            } else if (out === 0   ){
                                                                metaData = 'x-grid-center-icon';
                                                                // console.log(0);
                                                            }
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            // in use
                                                            var me = this;
                                                            //STORE
                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stVodomer = Ext.data.StoreManager.get("StVodomer");
                                                            //LOGIN & PASSWORD
                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                what:'AVodomer'
                                                            };
                                                            //GRID
                                                            var grAppVodomer = Ext.getCmp('grAppVodomer');
                                                            //FORMA
                                                            var value = stVodomer.getAt(rowIndex).data;
                                                            //LOGIKA
                                                            Ext.Object.merge(value, params);
                                                            //console.log(value);
                                                            Ext.MessageBox.confirm({
                                                                title: 'Вывод водомера в поверку (ремонт)',
                                                                msg: 'Вы выводите водомер в поверку (ремонт) <br>Подтвердите или отмените свои действия.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'подтвеждаю',
                                                                    cancel:'отмена'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        QueryVodomer.inVodomerHistory(value,function(results){
                                                                            if (results.success==="1"){
                                                                                stVodomer.load({
                                                                                    params: {
                                                                                        what:'AppVodomer',
                                                                                        address_id: value.address_id,
                                                                                        vodomer_id: value.vodomer_id,
                                                                                        login:value.login,
                                                                                        password:value.password
                                                                                    },
                                                                                    callback: function(records,operation,success){
                                                                                        if(success){
                                                                                            grAppVodomer.getView().getSelectionModel().select(rowIndex);
                                                                                            Ext.MessageBox.show({
                                                                                                title: 'Вывод cчетчика воды на поверку (ремонт)',
                                                                                                msg: results.msg,
                                                                                                buttons: Ext.MessageBox.OK,
                                                                                                icon: Ext.MessageBox.INFO
                                                                                            });
                                                                                        }
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            });


                                                        },
                                                        icon: 'resources/css/images/ico/maintenance_16.png',
                                                        tooltip: 'Вывод водомера на поверку'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'actioncolumn',
                                                width: 30,
                                                menuDisabled: true,
                                                items: [
                                                    {
                                                        getClass: function(v, metadata, r, rowIndex, colIndex, store) {
                                                            metaData = 'x-grid-center-icon';
                                                            return metaData;
                                                        },
                                                        handler: function(view, rowIndex, colIndex, item, e, record, row) {
                                                            // in use
                                                            var me = this;
                                                            //STORE

                                                            var stUser = Ext.data.StoreManager.get("StUser");
                                                            var stHPribor = Ext.data.StoreManager.get("StHVodomer");

                                                            //LOGIN & PASSWORD

                                                            var values =stUser.getAt(0);
                                                            var params = {
                                                                login:values.get('login'),
                                                                password:values.get('password'),
                                                                address_id:values.get('address_id'),
                                                                what:'AVodomer'
                                                            };
                                                            //GRID
                                                            var store = view.getStore();
                                                            var value = store.getAt(rowIndex).data;
                                                            // FORM

                                                            //GRID
                                                            //var grAppVodomer = Ext.getCmp('grAppVodomer');
                                                            //LOGIKA

                                                            Ext.Object.merge(value, params);
                                                            //console.log(value);

                                                            Ext.MessageBox.confirm({
                                                                title: 'Удаление прибора учета в историю',
                                                                msg: 'Вы удаляете прибор учета</b><br>Подтвердите или отмените свои действия.',
                                                                buttons: Ext.MessageBox.OKCANCEL,
                                                                icon: Ext.MessageBox.ERROR,
                                                                buttonText:{
                                                                    ok:'подтвеждаю',
                                                                    cancel:'отмена'
                                                                },
                                                                fn:function(btn,newValue){
                                                                    if(btn=='ok'){
                                                                        QueryVodomer.spisanVodomer(value,function(results){
                                                                            if(results.success==="1"){
                                                                                store.load({
                                                                                    params: {
                                                                                        login:value.login,
                                                                                        what:'AppVodomer',
                                                                                        password:value.password,
                                                                                        address_id: value.address_id,
                                                                                        what_id: value.address_id
                                                                                    },
                                                                                    scope:this
                                                                                });

                                                                                stHPribor.load({
                                                                                    params: {
                                                                                        login:value.login,
                                                                                        password:value.password,
                                                                                        what:'AppHVodomer',
                                                                                        address_id: value.address_id,
                                                                                        what_id: value.address_id
                                                                                    },
                                                                                    scope:this
                                                                                });
                                                                            } else {
                                                                                Ext.MessageBox.show({
                                                                                    title: 'Удаление прибора учета в историю',
                                                                                    msg: results.msg,
                                                                                    buttons: Ext.MessageBox.OK,
                                                                                    icon: Ext.MessageBox.ERROR
                                                                                });
                                                                            }
                                                                        });
                                                                    }
                                                                }
                                                            });
                                                        },
                                                        icon: 'resources/css/images/ico/no.png',
                                                        tooltip: 'Удалить  водомер в историю'
                                                    }
                                                ]
                                            }
                                        ],
                                        selModel: Ext.create('Ext.selection.CheckboxModel', {
                                            selType: 'checkboxmodel'
                                        })
                                    },
                                    {
                                        xtype: 'button',
                                        x: 0,
                                        y: 0,
                                        id: 'addAppVodomer',
                                        width: 365,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Добавить новый прибор учета воды'
                                    },
                                    {
                                        xtype: 'button',
                                        x: 200,
                                        y: 290,
                                        id: 'aktOplombirovki',
                                        width: 165,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Акт опломбировки'
                                    },
                                    {
                                        xtype: 'button',
                                        x: 5,
                                        y: 290,
                                        id: 'aktRasplombirovki',
                                        width: 160,
                                        icon: 'resources/css/images/ico/add.png',
                                        text: 'Акт распломбировки'
                                    },
                                    {
                                        xtype: 'fieldset',
                                        x: 550,
                                        y: 250,
                                        height: 190,
                                        style: 'background-color: #F1EEEE ;',
                                        width: 450,
                                        layout: 'absolute',
                                        title: 'начислить по среднему',
                                        items: [
                                            {
                                                xtype: 'datefield',
                                                x: 0,
                                                y: 0,
                                                disabled: true,
                                                width: 190,
                                                fieldLabel: 'Акт Распл',
                                                labelWidth: 75,
                                                name: 'date_ar',
                                                format: 'd-m-Y',
                                                submitFormat: 'Ymd'
                                            },
                                            {
                                                xtype: 'datefield',
                                                x: 200,
                                                y: 0,
                                                disabled: true,
                                                width: 175,
                                                fieldLabel: 'Акт Опл',
                                                labelWidth: 70,
                                                name: 'date_ao',
                                                format: 'd-m-Y',
                                                submitFormat: 'Ymd',
                                                listeners: {
                                                    select: 'onDatefieldSelect'
                                                }
                                            },
                                            {
                                                xtype: 'numberfield',
                                                x: 225,
                                                y: 130,
                                                shadowOffset: 1,
                                                disabled: true,
                                                width: 95,
                                                fieldLabel: 'Куб Ср',
                                                labelWidth: 50,
                                                name: 'newKubov',
                                                value: 0,
                                                allowBlank: false,
                                                hideTrigger: true,
                                                selectOnFocus: true,
                                                allowDecimals: false,
                                                autoStripChars: true,
                                                decimalPrecision: 0,
                                                minValue: 0,
                                                negativeText: 'Значение должно быть больше 1'
                                            },
                                            {
                                                xtype: 'numberfield',
                                                x: 0,
                                                y: 130,
                                                shadowOffset: 1,
                                                disabled: true,
                                                width: 90,
                                                fieldLabel: 'Дни cр',
                                                labelAlign: 'right',
                                                labelWidth: 50,
                                                name: 'mday',
                                                value: 0,
                                                allowBlank: false,
                                                hideTrigger: true,
                                                selectOnFocus: true,
                                                allowDecimals: false,
                                                autoStripChars: true,
                                                decimalPrecision: 0,
                                                minValue: 0,
                                                negativeText: 'Значение должно быть больше 1'
                                            },
                                            {
                                                xtype: 'button',
                                                x: 325,
                                                y: 130,
                                                shadowOffset: 2,
                                                border: '2px',
                                                disabled: true,
                                                id: 'insMeedlePokVod',
                                                width: 100,
                                                icon: 'resources/css/images/ico/yes22.png',
                                                text: 'Записать '
                                            },
                                            {
                                                xtype: 'fieldset',
                                                x: 0,
                                                y: 30,
                                                height: 90,
                                                style: 'background-color: #DCDCDC;',
                                                width: 428,
                                                layout: 'absolute',
                                                title: 'Просчитать по среднему',
                                                items: [
                                                    {
                                                        xtype: 'datefield',
                                                        x: 155,
                                                        y: 0,
                                                        disabled: true,
                                                        width: 140,
                                                        fieldLabel: 'По дату',
                                                        labelWidth: 55,
                                                        name: 'date_fin',
                                                        hideTrigger: true,
                                                        format: 'd-m-Y',
                                                        submitFormat: 'Ymd'
                                                    },
                                                    {
                                                        xtype: 'datefield',
                                                        x: 0,
                                                        y: 0,
                                                        disabled: true,
                                                        width: 145,
                                                        fieldLabel: 'От даты',
                                                        labelWidth: 55,
                                                        name: 'date_st',
                                                        hideTrigger: true,
                                                        format: 'd-m-Y',
                                                        submitFormat: 'Ymd'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 0,
                                                        y: 30,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 145,
                                                        fieldLabel: 'Показ от',
                                                        labelWidth: 65,
                                                        name: 'pok_ot',
                                                        value: 0,
                                                        allowBlank: false,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        allowDecimals: false,
                                                        autoStripChars: true,
                                                        decimalPrecision: 0,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        x: 155,
                                                        y: 30,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 140,
                                                        fieldLabel: 'Показ до',
                                                        labelWidth: 65,
                                                        name: 'pok_do',
                                                        value: 0,
                                                        allowBlank: false,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        allowDecimals: false,
                                                        autoStripChars: true,
                                                        decimalPrecision: 0,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        anchor: '100%',
                                                        x: 300,
                                                        y: 0,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 110,
                                                        fieldLabel: 'Кол дней',
                                                        labelWidth: 60,
                                                        name: 'rday',
                                                        value: 0,
                                                        allowBlank: false,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        allowDecimals: false,
                                                        autoStripChars: true,
                                                        decimalPrecision: 0,
                                                        minValue: 0,
                                                        negativeText: 'Значение должно быть больше 1'
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        anchor: '100%',
                                                        x: 300,
                                                        y: 30,
                                                        shadowOffset: 1,
                                                        disabled: true,
                                                        width: 120,
                                                        fieldLabel: 'Куб расч',
                                                        labelWidth: 60,
                                                        name: 'qty_kub',
                                                        value: 0,
                                                        allowBlank: false,
                                                        hideTrigger: true,
                                                        selectOnFocus: true,
                                                        allowDecimals: false,
                                                        autoStripChars: true,
                                                        decimalPrecision: 0,
                                                        minValue: 0
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'numberfield',
                                                x: 95,
                                                y: 130,
                                                shadowOffset: 1,
                                                disabled: true,
                                                width: 120,
                                                fieldLabel: 'Куб/День',
                                                labelWidth: 60,
                                                name: 'kub_day',
                                                value: 0,
                                                allowBlank: false,
                                                hideTrigger: true,
                                                selectOnFocus: true,
                                                autoStripChars: true,
                                                decimalPrecision: 4
                                            },
                                            {
                                                xtype: 'button',
                                                x: 390,
                                                y: 0,
                                                formBind: true,
                                                shadowOffset: 2,
                                                id: 'AddMeedlePokVod',
                                                icon: 'resources/css/images/ico/schet.png',
                                                scale: 'medium',
                                                text: '',
                                                tooltip: 'Просчитать по среднему'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldcontainer',
                                        x: 700,
                                        y: 0,
                                        height: 120,
                                        style: 'background-color: #F1EEEE ;',
                                        width: 300,
                                        layout: 'absolute',
                                        fieldLabel: 'по льготе',
                                        labelAlign: 'top',
                                        items: [
                                            {
                                                xtype: 'fieldset',
                                                x: 5,
                                                y: 0,
                                                height: 80,
                                                style: 'background-color: #DCDCDC;',
                                                width: 130,
                                                title: 'кубов по льготе',
                                                items: [
                                                    {
                                                        xtype: 'textfield',
                                                        anchor: '100%',
                                                        width: 120,
                                                        fieldLabel: 'Хвода',
                                                        labelWidth: 50,
                                                        name: 'xkub_lg',
                                                        readOnly: true
                                                    },
                                                    {
                                                        xtype: 'numberfield',
                                                        anchor: '100%',
                                                        fieldLabel: 'Гвода',
                                                        labelWidth: 50,
                                                        name: 'gkub_lg',
                                                        readOnly: true
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'numberfield',
                                                x: 150,
                                                y: 0,
                                                width: 135,
                                                fieldLabel: 'Хвода',
                                                labelWidth: 40,
                                                name: 'lgota_xv',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'numberfield',
                                                x: 150,
                                                y: 30,
                                                width: 135,
                                                fieldLabel: 'Гвода',
                                                labelWidth: 40,
                                                name: 'lgota_st',
                                                readOnly: true
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldcontainer',
                                        x: 700,
                                        y: 125,
                                        height: 120,
                                        style: 'background-color: #F1EEEE ;',
                                        width: 145,
                                        layout: 'anchor',
                                        fieldLabel: 'тарифы',
                                        labelAlign: 'top',
                                        items: [
                                            {
                                                xtype: 'numberfield',
                                                anchor: '100%',
                                                padding: '0 5 0 5',
                                                width: 115,
                                                fieldLabel: 'Хвода',
                                                labelWidth: 40,
                                                name: 'tarif_xv',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'numberfield',
                                                anchor: '100%',
                                                padding: '0 5 0 5',
                                                width: 115,
                                                fieldLabel: 'Гвода',
                                                labelWidth: 40,
                                                name: 'tarif_st',
                                                readOnly: true
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldcontainer',
                                        x: 855,
                                        y: 125,
                                        height: 120,
                                        style: 'background-color: #F1EEEE ;',
                                        width: 145,
                                        layout: 'anchor',
                                        fieldLabel: 'начислено',
                                        labelAlign: 'top',
                                        items: [
                                            {
                                                xtype: 'numberfield',
                                                anchor: '100%',
                                                padding: '0 5 0 5',
                                                width: 120,
                                                fieldLabel: 'Хвода',
                                                labelWidth: 40,
                                                name: 'xvoda',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'numberfield',
                                                anchor: '100%',
                                                padding: '0 5 0 5',
                                                width: 120,
                                                fieldLabel: 'Гвода',
                                                labelWidth: 40,
                                                name: 'stoki',
                                                readOnly: true
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        x: 375,
                                        y: 0,
                                        height: 440,
                                        style: 'background-color: #F1EEEE ;',
                                        width: 170,
                                        layout: 'absolute',
                                        title: 'Техн. характеристика',
                                        items: [
                                            {
                                                xtype: 'displayfield',
                                                renderer: function(value, displayField) {
                                                    var retValue = '';
                                                    switch (value) {
                                                        case 'Хвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeX.png"/></span>';
                                                        break;
                                                        case 'Гвода':
                                                        retValue ='<span><img clas="icon" src="resources/css/images/ico/pipeGv.png"/></span>';
                                                        break;

                                                    }
                                                    return retValue;
                                                },
                                                x: 0,
                                                y: 0,
                                                height: 42,
                                                width: 50,
                                                fieldLabel: '',
                                                labelSeparator: ' ',
                                                name: 'voda'
                                            },
                                            {
                                                xtype: 'textfield',
                                                x: 55,
                                                y: 10,
                                                width: 90,
                                                fieldLabel: '',
                                                labelWidth: 50,
                                                name: 'vodomer_id',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'datefield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 50,
                                                width: 140,
                                                fieldLabel: 'Дата',
                                                labelWidth: 45,
                                                name: 'sdate',
                                                readOnly: true,
                                                altFormats: 'd-m-Y|m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j',
                                                format: 'd-m-Y'
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 85,
                                                width: 140,
                                                fieldLabel: 'Пломба',
                                                labelWidth: 50,
                                                name: 'zplomba',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 115,
                                                width: 140,
                                                fieldLabel: '',
                                                labelWidth: 75,
                                                name: 'model',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 145,
                                                width: 140,
                                                fieldLabel: 'Номер',
                                                labelWidth: 50,
                                                name: 'nomer',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 175,
                                                width: 140,
                                                fieldLabel: 'Место',
                                                labelWidth: 50,
                                                name: 'place',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 205,
                                                width: 140,
                                                fieldLabel: 'Позиция',
                                                labelWidth: 75,
                                                name: 'position',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'fieldset',
                                                anchor: '100%',
                                                x: 0,
                                                y: 240,
                                                height: 110,
                                                style: 'background-color: #DCDCDC;',
                                                width: 160,
                                                title: 'Поверка',
                                                items: [
                                                    {
                                                        xtype: 'datefield',
                                                        anchor: '100%',
                                                        width: 165,
                                                        fieldLabel: 'Дата',
                                                        labelWidth: 35,
                                                        name: 'pdate',
                                                        readOnly: true,
                                                        altFormats: 'd.m.y|d/m/Y|d-m-y|d-m-Y|d/m|d-m|dm|dmy|dmY|d|Y-m-d',
                                                        format: 'd-m-Y'
                                                    },
                                                    {
                                                        xtype: 'datefield',
                                                        anchor: '100%',
                                                        width: 165,
                                                        fieldLabel: 'След',
                                                        labelWidth: 35,
                                                        name: 'fpdate',
                                                        readOnly: true,
                                                        altFormats: 'd-m-Y|m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j',
                                                        format: 'd-m-y'
                                                    },
                                                    {
                                                        xtype: 'textfield',
                                                        anchor: '100%',
                                                        width: 165,
                                                        fieldLabel: 'Пломба',
                                                        labelWidth: 50,
                                                        name: 'plomba'
                                                    }
                                                ]
                                            },
                                            {
                                                xtype: 'displayfield',
                                                renderer: function(value, displayField) {
                                                    var retValue = '';
                                                    switch (value) {
                                                        case 1:
                                                        retValue ='<span><img class="icon" src="resources/css/images/ico/yes.png"/></span>';
                                                        break;
                                                        case 0:
                                                        retValue ='<span><img class="icon" src="resources/css/images/ico/no.png"/></span>';
                                                        break;
                                                    }
                                                    return retValue;
                                                },
                                                x: 15,
                                                y: 355,
                                                width: 85,
                                                fieldLabel: 'Общий',
                                                labelWidth: 50,
                                                name: 'joint'
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 385,
                                                width: 140,
                                                fieldLabel: 'Дводомер',
                                                hideEmptyLabel: false,
                                                labelWidth: 75,
                                                name: 'dvodomer_id',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'hiddenfield',
                                                x: 154,
                                                y: 10,
                                                width: 120,
                                                fieldLabel: '',
                                                labelWidth: 75,
                                                name: 'type'
                                            },
                                            {
                                                xtype: 'hiddenfield',
                                                x: 112,
                                                y: 23,
                                                width: 160,
                                                fieldLabel: 'Место',
                                                labelWidth: 60,
                                                name: 'house_id'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        x: 5,
                                        y: 330,
                                        height: 110,
                                        style: 'background-color: #F1EEEE ;',
                                        width: 360,
                                        layout: 'absolute',
                                        title: 'ввод новых показаний ',
                                        items: [
                                            {
                                                xtype: 'textfield',
                                                x: 0,
                                                y: 10,
                                                width: 135,
                                                fieldLabel: 'текущ',
                                                labelWidth: 50,
                                                name: 'tekp',
                                                readOnly: true,
                                                allowBlank: false
                                            },
                                            {
                                                xtype: 'numberfield',
                                                x: 0,
                                                y: 45,
                                                formBind: true,
                                                shadowOffset: 1,
                                                width: 135,
                                                fieldLabel: 'новое',
                                                labelWidth: 50,
                                                name: 'newValue',
                                                value: 0,
                                                hideTrigger: true,
                                                selectOnFocus: true,
                                                allowDecimals: false,
                                                autoStripChars: true,
                                                decimalPrecision: 0,
                                                minValue: 0,
                                                negativeText: 'Значение должно быть больше 1'
                                            },
                                            {
                                                xtype: 'button',
                                                x: 155,
                                                y: 45,
                                                formBind: true,
                                                shadowOffset: 2,
                                                border: '2px',
                                                id: 'insTekPokVod',
                                                width: 185,
                                                icon: 'resources/css/images/ico/yes22.png',
                                                text: 'Записать  показания'
                                            },
                                            {
                                                xtype: 'hiddenfield',
                                                x: 312,
                                                y: 84,
                                                fieldLabel: 'Label',
                                                name: 'out'
                                            },
                                            {
                                                xtype: 'checkboxfield',
                                                x: 155,
                                                y: 10,
                                                width: 180,
                                                fieldLabel: 'за пред. месяц',
                                                labelWidth: 120,
                                                name: 'prev',
                                                boxLabel: '',
                                                inputValue: '1'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'fieldset',
                                        x: 550,
                                        y: 0,
                                        height: 245,
                                        style: 'background-color: #F1EEEE ;',
                                        width: 145,
                                        layout: 'absolute',
                                        title: 'показания, кубы',
                                        items: [
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 0,
                                                fieldLabel: 'ид_пок',
                                                labelWidth: 55,
                                                name: 'pok_id',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'datefield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 35,
                                                width: 140,
                                                fieldLabel: 'Дата',
                                                labelWidth: 35,
                                                name: 'fdate',
                                                readOnly: true,
                                                altFormats: 'd.m.y|d/m/Y|d-m-y|d-m-Y|d/m|d-m|dm|dmy|dmY|d|Y-m-d',
                                                format: 'd-m-Y'
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 68,
                                                fieldLabel: 'пред',
                                                labelWidth: 55,
                                                name: 'pred',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 102,
                                                fieldLabel: 'тек',
                                                labelWidth: 55,
                                                name: 'tek',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'textfield',
                                                anchor: '100%',
                                                x: 0,
                                                y: 134,
                                                fieldLabel: 'кубов',
                                                labelWidth: 55,
                                                name: 'kub',
                                                readOnly: true
                                            },
                                            {
                                                xtype: 'button',
                                                anchor: '100%',
                                                x: 0,
                                                y: 168,
                                                disabled: true,
                                                id: 'delTekPokVod',
                                                icon: 'resources/css/images/ico/no.png',
                                                text: 'Удалить  показ'
                                            },
                                            {
                                                xtype: 'checkboxfield',
                                                handler: function(checkbox, checked) {
                                                    var form = checkbox.findParentByType('form');
                                                    if(checked){

                                                        form.down('#delTekPokVod').setDisabled(false);

                                                    }else{

                                                        form.down('#delTekPokVod').setDisabled(true);

                                                    }
                                                },
                                                anchor: '100%',
                                                x: 0,
                                                y: 195,
                                                id: 'vklDelPokVod',
                                                fieldLabel: 'вкл. кнопку',
                                                labelWidth: 80,
                                                name: 'vkl_del',
                                                boxLabel: ''
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                xtype: 'gridpanel',
                                id: 'grAllPokVodomera',
                                margin: '5 0 0 0',
                                width: 1024,
                                title: 'История показаний прибора учета',
                                emptyText: 'Нет показаний по прибору учета',
                                store: 'StWater',
                                viewConfig: {
                                    getRowClass: function(record, rowIndex, rowParams, store) {
                                        return record.get('pok_ot') === 0 ? "" : 'change_color';
                                    }
                                },
                                columns: [
                                    {
                                        xtype: 'numbercolumn',
                                        hidden: true,
                                        dataIndex: 'address_id',
                                        text: 'Address_id'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        hidden: true,
                                        dataIndex: 'period',
                                        text: 'Address'
                                    },
                                    {
                                        xtype: 'numbercolumn',
                                        hidden: true,
                                        dataIndex: 'nomer',
                                        text: 'Nomer'
                                    },
                                    {
                                        xtype: 'datecolumn',
                                        hidden: true,
                                        dataIndex: 'data',
                                        text: 'Data',
                                        format: 'd-m-y'
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        menuDisabled: true,
                                        text: 'показания',
                                        columns: [
                                            {
                                                xtype: 'datecolumn',
                                                width: 90,
                                                dataIndex: 'fdate',
                                                menuDisabled: true,
                                                text: 'дата',
                                                format: 'd-m-y'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 67,
                                                dataIndex: 'pred',
                                                menuDisabled: true,
                                                text: 'пред',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 65,
                                                dataIndex: 'tek',
                                                menuDisabled: true,
                                                text: 'тек',
                                                format: '0'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 67,
                                                dataIndex: 'kub',
                                                menuDisabled: true,
                                                text: 'кубы',
                                                format: '0'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        menuDisabled: true,
                                        text: 'тариф',
                                        columns: [
                                            {
                                                xtype: 'numbercolumn',
                                                width: 80,
                                                dataIndex: 'tarif_xv',
                                                menuDisabled: true,
                                                text: 'Хвода',
                                                format: '0.000'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 80,
                                                dataIndex: 'tarif_st',
                                                menuDisabled: true,
                                                text: 'Гвода',
                                                format: '0.000'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        menuDisabled: true,
                                        text: 'начислено',
                                        columns: [
                                            {
                                                xtype: 'numbercolumn',
                                                width: 90,
                                                dataIndex: 'xvoda',
                                                menuDisabled: true,
                                                text: 'Хвода'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 90,
                                                dataIndex: 'stoki',
                                                menuDisabled: true,
                                                text: 'Гвода'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        menuDisabled: true,
                                        text: 'по льготе',
                                        columns: [
                                            {
                                                xtype: 'numbercolumn',
                                                draggable: false,
                                                resizable: false,
                                                width: 65,
                                                detachOnRemove: false,
                                                enableColumnHide: false,
                                                dataIndex: 'xkub_lg',
                                                hideable: false,
                                                menuDisabled: true,
                                                text: 'куб_хв',
                                                format: '0.000'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 65,
                                                dataIndex: 'gkub_lg',
                                                menuDisabled: true,
                                                text: 'куб_гв',
                                                format: '0.000'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 80,
                                                dataIndex: 'lgota_xv',
                                                menuDisabled: true,
                                                text: 'Хвода'
                                            },
                                            {
                                                xtype: 'numbercolumn',
                                                width: 60,
                                                dataIndex: 'lgota_st',
                                                menuDisabled: true,
                                                text: 'Гвода'
                                            }
                                        ]
                                    },
                                    {
                                        xtype: 'gridcolumn',
                                        width: 80,
                                        dataIndex: 'operator',
                                        menuDisabled: true,
                                        text: 'оператор'
                                    }
                                ],
                                tools: [
                                    {
                                        xtype: 'tool',
                                        callback: function(owner, tool, event) {
                                            //in use
                                            var grid = tool.findParentByType('grid');
                                            var fmVodomer = Ext.getCmp('fmVodomer');
                                            var vodomer_id = fmVodomer.getForm().findField('vodomer_id').getValue();
                                            //STORE
                                            var stUser = Ext.data.StoreManager.get("StUser");
                                            var stWater = Ext.data.StoreManager.get("StWater");
                                            //LOGIN & PASSWORD
                                            var values =stUser.getAt(0);

                                            //LOGIKA
                                            if(!Ext.isEmpty(vodomer_id)){
                                                stWater.removeAll();
                                                stWater.load({
                                                    params: {
                                                        login:values.get('login'),
                                                        password:values.get('password'),
                                                        address_id:values.get('address_id'),
                                                        what:'AllPokVodomeraAll',
                                                        what_id: values.get('address_id'),
                                                        vodomer_id: vodomer_id
                                                    },
                                                    callback: function(records,operation,success){
                                                        if(success){
                                                            //console.log(grid);
                                                            grid.getView().refresh();
                                                        }
                                                    },
                                                    scope:this
                                                });
                                            }else{
                                                Ext.MessageBox.show({
                                                    title: 'Просмотр истории показаний cчетчика воды',
                                                    msg: "Выберите счетчик воды",
                                                    buttons: Ext.MessageBox.OK,
                                                    icon: Ext.MessageBox.INFO
                                                });
                                            }
                                        },
                                        tooltip: 'Загрузить все показания счетчика',
                                        type: 'search'
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
        if (instanceConfig) {
            me.getConfigurator().merge(me, config, instanceConfig);
        }
        return me.callParent([config]);
    },

    onDatefieldSelect: function(field, value, eOpts) {
        Ext.getCmp('AddMeedlePokVod').setDisabled(false);


    }

});