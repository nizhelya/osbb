/*
 * File: app/controller/AppNach.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Osbb.controller.AppNach', {
    extend: 'Ext.app.Controller',

    refs: {
        WinAddLgotaPerer: '#winAddLgotaPerer',
        WinEditOplata: '#winEditOplata',
        WinEditDbfLgota: '#winEditDbfLgota',
        winImport: {
            selector: 'winImport',
            xtype: 'winimport'
        }
    },

    control: {
        "#tabNachApp": {
            activate: 'onTabNachAppActivate'
        },
        "#tabOplata": {
            activate: 'onTabOplataActivate'
        },
        "#tabPodogrev": {
            activate: 'onTabPodogrevActivate'
        },
        "#tabFmAppVoda": {
            activate: 'onTabFmAppVodaActivate'
        },
        "#tabFmAppStoki": {
            activate: 'onTabFmAppStokiActivate'
        },
        "#tabFmAppPodogrev": {
            activate: 'onTabFmAppPodogrevActivate'
        },
        "#tabFmAppOtoplenie": {
            activate: 'onTabFmAppOtoplActivate'
        },
        "#tabFmAppPtn": {
            activate: 'onTabFmAppPtnActivate'
        },
        "#tabFmAppTbo": {
            activate: 'onTabFmAppTboActivate'
        },
        "#tabFmAppKvartplata": {
            activate: 'onTabFmAppKvartplataActivate'
        },
        "#tabFmAppEnergy": {
            activate: 'onTabFmAppEnergyActivate'
        },
        "#tabFmAppRfond": {
            activate: 'onTabFmAppRfondActivate'
        },
        "#tabFmAppVaxta": {
            activate: 'onTabFmAppVaxtaActivate'
        },
        "#exportBudjet": {
            activate: 'onExportBudjetActivate'
        },
        "#tabDbfLgota": {
            activate: 'onTabDbfLgotaActivate'
        },
        "#tabPort": {
            activate: 'onTabPortActivate'
        },
        "#tabSubsidia": {
            activate: 'onTabSubsidiaActivate'
        },
        "#grNachVoda": {
            selectionchange: 'onGrNachVodaSelectionChange'
        },
        "#grLgotaNachVoda": {
            selectionchange: 'onGrLgotaNachVodaSelectionChange'
        },
        "#grNachStoki": {
            selectionchange: 'onGrNachStokiSelectionChange'
        },
        "#grLgotaNachStoki": {
            selectionchange: 'onGrLgotaNachStokiSelectionChange'
        },
        "#grNachPodogrev": {
            selectionchange: 'onGrNachPodogrevSelectionChange'
        },
        "#grLgotaNachPodogrev": {
            selectionchange: 'onGrLgotaNachPodogrevSelectionChange'
        },
        "#grNachOtoplenie": {
            selectionchange: 'onGrNachOtoplenieSelectionChange'
        },
        "#grLgotaNachOtoplenie": {
            selectionchange: 'onGrLgotaNachOtoplenieSelectionChange'
        },
        "#grNachTbo": {
            selectionchange: 'onGrNachTboSelectionChange'
        },
        "#grLgotaNachTbo": {
            selectionchange: 'onGrLgotaNachTboSelectionChange'
        },
        "#grNachKvartplata": {
            selectionchange: 'onGrNachKvartplataSelectionChange'
        },
        "#grLgotaNachKvartplata": {
            selectionchange: 'onGrLgotaNachKvartplataSelectionChange'
        },
        "#grTarifHousesPodogrev": {
            selectionchange: 'onGrTarifHousesPodogrevSelectionChange'
        },
        "#grNachEnergy": {
            selectionchange: 'onGrNachEnergySelectionChange'
        },
        "#btAddLgotaPerer": {
            click: 'onBtAddLgotaPererClick'
        },
        "#btUpdKubNorma": {
            click: 'onBtUpdKubNormaClick'
        },
        "#btAddNachPodogrev": {
            click: 'onBtAddNachPodogrevClick'
        },
        "#btAddPererPodogrev": {
            click: 'onBtAddPererPodogrevClick'
        },
        "#btExportBudjet": {
            click: 'onBtExportBudjetClick'
        },
        "#btControlLgot": {
            click: 'onBtControlLgotClick'
        },
        "#btControlDbfLgot": {
            click: 'onBtControlDbfLgotClick'
        },
        "#btFixDolg": {
            click: 'onBtFixDolgClick'
        },
        "#btEditOplata": {
            click: 'onBtEditOplataClick'
        },
        "#btEditDbfLgota": {
            click: 'onBtEditDbfLgotaClick'
        },
        "#grNachVaxta": {
            selectionchange: 'onGrNachVaxtaSelectionChange'
        },
        "#tabSubsUtszn": {
            activate: 'onTabSubsUtsznActivate'
        },
        "#tabLgotaUtszn": {
            activate: 'onTabLgotaUtsznActivate'
        },
        "#grNachPtn": {
            selectionchange: 'onGrNachPtnSelectionChange'
        },
        "#grNachRfond": {
            selectionchange: 'onGrNachRfondSelectionChange'
        }
    },

    onTabNachAppActivate: function(component, eOpts) {
        //STORE

        var stUser = Ext.data.StoreManager.get("StUser");
        var stAppartment = Ext.data.StoreManager.get("StAppartment");//QueryAddress.getResults <Appartment>
        //var StOplata = Ext.data.StoreManager.get("StOplata");
        var tabPnNachApp = Ext.getCmp('tabPnNachApp');
        var fmInfoNachApp = Ext.getCmp('fmInfoNachApp');
        //var index = tabPnNachApp.items.indexOf(activeTab);
        tabPnNachApp.setActiveTab(0);

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        //  console.log(values);

        if (values.get('address_id'))
            stAppartment.load({
                params: {
                    what_id: values.get('address_id'),
                    address_id:  values.get('address_id'),
                    what:'Appartment',
                    login:values.get('login'),
                    password:values.get('password')
                },
                callback: function(records,operation,success){


                    if(success){

                        if (records.length) {
                            fmInfoNachApp.getForm().loadRecord(records[0]);

                            var adrec = fmInfoNachApp.getForm().findField('address').getValue();
                            var fio = fmInfoNachApp.getForm().findField('nanim').getValue();
                            var kod = fmInfoNachApp.getForm().findField('address_id').getValue();
                            var xv = records[0].data.voda;
                            var st = records[0].data.stoki;
                            var vx = records[0].data.vaxta;
                            var rf = records[0].data.rfond;
                            var ot = records[0].data.otoplenie;
                            var en = records[0].data.energy;
                            var tb = records[0].data.tbo;

                            if (xv ==="нет") {
                                tabPnNachApp.child('#tabFmAppVoda').tab.hide();
                            }else{
                                tabPnNachApp.child('#tabFmAppVoda').tab.show();
                            }
                            if (st ==="нет") {
                                tabPnNachApp.child('#tabFmAppStoki').tab.hide();
                            }else{
                                tabPnNachApp.child('#tabFmAppStoki').tab.show();
                            }
                            if (rf ==="нет") {
                                tabPnNachApp.child('#tabFmAppRfond').tab.hide();

                            }else{
                                tabPnNachApp.child('#tabFmAppRfond').tab.show();
                            }
                            if (vx ==="нет") {
                                tabPnNachApp.child('#tabFmAppVaxta').tab.hide();

                            }else{
                                tabPnNachApp.child('#tabFmAppVaxta').tab.show();
                            }
                            if (ot ==="нет") {
                                tabPnNachApp.child('#tabFmAppOtoplenie').tab.hide();
                                tabPnNachApp.child('#tabFmAppPtn').tab.hide();
                            }else{
                                tabPnNachApp.child('#tabFmAppOtoplenie').tab.show();
                                tabPnNachApp.child('#tabFmAppPtn').tab.show();
                            }
                            if (en ==="нет") {
                                tabPnNachApp.child('#tabFmAppEnergy').tab.hide();

                            }else{
                                tabPnNachApp.child('#tabFmAppEnergy').tab.show();
                            }
                            if (tb ==="нет") {
                                tabPnNachApp.child('#tabFmAppTbo').tab.hide();

                            }else{
                                tabPnNachApp.child('#tabFmAppTbo').tab.show();
                            }



                            fmInfoNachApp.setTitle('ид&nbsp;&nbsp'+ kod + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                                                   adrec + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +  fio);

                        }
                    }
                },
                scope:this
            });


    },

    onTabOplataActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        //console.log(stUser);

        var StOplata = Ext.data.StoreManager.get("StOplata");

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);

        StOplata.load({
            params: {
                what:'OplataApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            scope:this
        });

    },

    onTabPodogrevActivate: function(component, eOpts) {
        //STORE
        var form = Ext.getCmp('fmPodogrev');
        var btAddNach = Ext.getCmp('btAddNachPodogrev');
        var btAddPerer = Ext.getCmp('btAddPererPodogrev');
        var pnPerer = Ext.getCmp('pnPererPodogrev');
        var grid = Ext.getCmp('grTarifHousesPodogrev');
        var store = grid.getStore();
        store.removeAll();
        var dt = new Date();
        var firstDay = Ext.Date.getFirstDateOfMonth( dt ) ;

        form.getForm().reset();
        form.getForm().findField('data').setValue(Ext.Date.format(firstDay, 'Y-m-d'));
        btAddNach.setText("Начислить подогрев за период  "+ Ext.Date.format(firstDay, 'F,Y'));
        btAddPerer.setText("Перерасчитать подогрев  за  "+ Ext.Date.format(firstDay, 'F,Y'));
        pnPerer.setTitle("Перерасчет подогрев за период "+ Ext.Date.format(firstDay, 'F,Y'));
    },

    onTabFmAppVodaActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var StLgotaNach = Ext.data.StoreManager.get("StLgotaNachVoda");
        var gridNachisl = Ext.getCmp('grNachVoda');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;

        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'VodaApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                   // console.log(form.getForm());

                    form.getForm().reset();
                  //  gridNachisl.getView().refresh();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });
        StLgotaNach.load({
            params: {
                what:'LgotaNachVoda',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            }
        });
    },

    onTabFmAppStokiActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var StLgotaNach = Ext.data.StoreManager.get("StLgotaNachVoda");
        var gridNachisl = Ext.getCmp('grNachStoki');


        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'StokiApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                    form.getForm().reset();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });
        StLgotaNach.load({
            params: {
                what:'LgotaNachStoki',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            }
        });
    },

    onTabFmAppPodogrevActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var StLgotaNach = Ext.data.StoreManager.get("StLgotaNachVoda");
        var gridNachisl = Ext.getCmp('grNachPodogrev');


        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'PodogrevApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                   // console.log(form.getForm());

                    form.getForm().reset();
                  //  gridNachisl.getView().refresh();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });
        StLgotaNach.load({
            params: {
                what:'LgotaNachPodogrev',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            }
        });
    },

    onTabFmAppOtoplActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var StLgotaNach = Ext.data.StoreManager.get("StLgotaNachVoda");
        var gridNachisl = Ext.getCmp('grNachOtoplenie');


        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'OtoplenieApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                    form.getForm().reset();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });
        StLgotaNach.load({
            params: {
                what:'LgotaNachOtoplenie',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            }
        });
    },

    onTabFmAppPtnActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var StLgotaNach = Ext.data.StoreManager.get("StLgotaNachVoda");
        var gridNachisl = Ext.getCmp('grNachPtn');


        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'PtnApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                    // console.log(form.getForm());

                    form.getForm().reset();
                    //  gridNachisl.getView().refresh();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });
        StLgotaNach.load({
            params: {
                what:'LgotaNachPtn',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            }
        });
    },

    onTabFmAppTboActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var StLgotaNach = Ext.data.StoreManager.get("StLgotaNachVoda");
        var gridNachisl = Ext.getCmp('grNachTbo');


        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'TboApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                    form.getForm().reset();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });
        StLgotaNach.load({
            params: {
                what:'LgotaNachTbo',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            }
        });
    },

    onTabFmAppKvartplataActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var StLgotaNach = Ext.data.StoreManager.get("StLgotaNachVoda");
        var gridNachisl = Ext.getCmp('grNachKvartplata');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'KvartplataApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                   // console.log(form.getForm());
                  // gridNachisl.getView().refresh();
                    form.getForm().reset();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });
        StLgotaNach.load({
            params: {
                what:'LgotaNachKvartplata',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            }
        });
    },

    onTabFmAppEnergyActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var StLgotaNach = Ext.data.StoreManager.get("StLgotaNachVoda");
        var gridNachisl = Ext.getCmp('grNachEnergy');


        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'EnergyApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                   // console.log(form.getForm());

                    form.getForm().reset();
                  //  gridNachisl.getView().refresh();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });
        StLgotaNach.load({
            params: {
                what:'LgotaNachEnergy',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            }
        });
    },

    onTabFmAppRfondActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var gridNachisl = Ext.getCmp('grNachRfond');


        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'RfondApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                   // console.log(form.getForm());

                    form.getForm().reset();
                  //  gridNachisl.getView().refresh();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });

    },

    onTabFmAppVaxtaActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNach = Ext.data.StoreManager.get("StTekNachApp");
        var gridNachisl = Ext.getCmp('grNachVaxta');


        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        // FORM
        var form = component;
        // DATA

        //LOGIKA
        StTekNach.load({
            params: {
                what:'VaxtaApp',
                address_id: values.get('address_id'),
                login:values.get('login'),
                password:values.get('password')
            },
            callback: function(records,operation,success){
                if(success){
                    // console.log(form.getForm());

                    form.getForm().reset();
                    //  gridNachisl.getView().refresh();
                    gridNachisl.getView().getSelectionModel().select(0);

                }else{
                    form.getForm().reset();
                }
            },
            scope:this
        });

    },

    onExportBudjetActivate: function(component, eOpts) {
        var form = Ext.getCmp('fmExportBudjet');
        var dt = new Date();
        var firstDay = Ext.Date.getFirstDateOfMonth( dt ) ;
        form.getForm().findField('data').setValue(Ext.Date.format(firstDay, 'Y-m-d'));
        form.getForm().findField('subjectTo').setValue('utszn5139@ukr.net');
        form.getForm().findField('subjectFrom').setValue('svtpashkova@gmail.com');

        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var vibor = 'utszn';

    },

    onTabDbfLgotaActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var StSubsidia = Ext.data.StoreManager.get("StDbfLgota");
        var dataNach = Ext.getCmp('dataNachLgota');
        var btnGetSubsidiaOshadBank =  Ext.getCmp('btnGetLgotaOshadBank');
        var btnPrintLgotaReestrToOshadBank =  Ext.getCmp('btnPrintLgotaReestrToOshadBank');
        var btnPrintLgotaReestrFromOshadBank =  Ext.getCmp('btnPrintLgotaReestrFromOshadBank');

        var btnImportOshadBank =  Ext.getCmp('btnImportOshadBankLgota');
        var btnExportOshadBank =  Ext.getCmp('btnExportOshadBankLgota');
        var btnImportOplataOshad =  Ext.getCmp('btnImportOplataOshadLgota');
        var btnImportOplataYkis =  Ext.getCmp('btnImportOplataYkisLgota');
        var btnSubsidiaOtkat =  Ext.getCmp('btnLgotaOtkat');
        var dt = new Date() ;
        var firstDay = Ext.Date.getFirstDateOfMonth( dt ) ;
        dataNach.setValue(Ext.Date.format(firstDay, 'Y-m-d'));
        data = dataNach.getValue();
        var usluga_id = Ext.getCmp('cbUslugaLgota').getValue();
        var osmd_id = Ext.getCmp('cbOsmdLgota').getValue();

        if(usluga_id && osmd_id) {
            btnGetSubsidiaOshadBank.setDisabled(false);
            btnPrintLgotaReestrToOshadBank.setDisabled(false);
            btnPrintLgotaReestrFromOshadBank.setDisabled(false);

            btnImportOshadBank.setDisabled(false);
            btnExportOshadBank.setDisabled(false);
            btnImportOplataOshad.setDisabled(false);
            btnImportOplataYkis.setDisabled(false);
            btnSubsidiaOtkat.setDisabled(false);
            StSubsidia.load({
                params: {
                    what:'getDbfLgota',
                    login:values.get('login'),
                    password:values.get('password'),
                    data:data,
                    osmd_id: osmd_id,
                    usluga_id:usluga_id
                },
                scope:this
            });

        } else {
            btnGetSubsidiaOshadBank.setDisabled(true);
            btnPrintLgotaReestrToOshadBank.setDisabled(true);
            btnPrintLgotaReestrFromOshadBank.setDisabled(true);
            btnImportOshadBank.setDisabled(true);
            btnExportOshadBank.setDisabled(true);
            btnImportOplataOshad.setDisabled(true);
            btnImportOplataYkis.setDisabled(true);
            btnSubsidiaOtkat.setDisabled(true);
        }
    },

    onTabPortActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        //console.log(stUser);

        var StPort = Ext.data.StoreManager.get("StPort");
        var dataNach = Ext.getCmp('dataNachPort');

        var dt = new Date() ;
        var firstDay = Ext.Date.getFirstDateOfMonth( dt ) ;
        dataNach.setValue(Ext.Date.format(firstDay, 'Y-m-d'));

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);

        StPort.load({
            params: {
                what:'getPort',
                login:values.get('login'),
                password:values.get('password')
            }
        });


    },

    onTabSubsidiaActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var StSubsidia = Ext.data.StoreManager.get("StSubsidia");
        var dataNach = Ext.getCmp('dataNachSubsidia');
        var btnGetSubsidiaOshadBank =  Ext.getCmp('btnGetSubsidiaOshadBank');
        var btnPrintSubsReestrToOshadBank =  Ext.getCmp('btnPrintSubsReestrToOshadBank');
        var btnPrintSubsReestrFromOshadBank =  Ext.getCmp('btnPrintSubsReestrFromOshadBank');

        var btnImportOshadBank =  Ext.getCmp('btnImportOshadBank');
        var btnExportOshadBank =  Ext.getCmp('btnExportOshadBank');
        var btnImportOplataOshad =  Ext.getCmp('btnImportOplataOshad');
        var btnImportOplataYkis =  Ext.getCmp('btnImportOplataYkis');
        var btnSubsidiaOtkat =  Ext.getCmp('btnSubsidiaOtkat');
        var dt = new Date() ;
        var firstDay = Ext.Date.getFirstDateOfMonth( dt ) ;
        dataNach.setValue(Ext.Date.format(firstDay, 'Y-m-d'));
        data = dataNach.getValue();
        var usluga_id = Ext.getCmp('cbUslugaSubsidia').getValue();
        var osmd_id = Ext.getCmp('cbOsmdSubsidia').getValue();

        if(usluga_id && osmd_id) {
            btnGetSubsidiaOshadBank.setDisabled(false);
            btnPrintSubsReestrToOshadBank.setDisabled(false);
            btnPrintSubsReestrFromOshadBank.setDisabled(false);

            btnImportOshadBank.setDisabled(false);
            btnExportOshadBank.setDisabled(false);
            btnImportOplataOshad.setDisabled(false);
            btnImportOplataYkis.setDisabled(false);
            btnSubsidiaOtkat.setDisabled(false);
            StSubsidia.load({
                params: {
                    what:'getSubsidia',
                    login:values.get('login'),
                    password:values.get('password'),
                    data:data,
                    osmd_id: osmd_id,
                    usluga_id:usluga_id
                },
                scope:this
            });

        } else {
            btnGetSubsidiaOshadBank.setDisabled(true);
            btnPrintSubsReestrToOshadBank.setDisabled(false);
            btnPrintSubsReestrFromOshadBank.setDisabled(false);
            btnImportOshadBank.setDisabled(true);
            btnExportOshadBank.setDisabled(true);
            btnImportOplataOshad.setDisabled(true);
            btnImportOplataYkis.setDisabled(true);
            btnSubsidiaOtkat.setDisabled(true);
        }
    },

    onGrNachVodaSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StLgotaNachVoda = Ext.data.StoreManager.get("StLgotaNachVoda");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppVoda');
        //console.log(selected[0].data.data);

        //var record = selected[0].data;
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            StLgotaNachVoda.load({
                params: {
                    what:'LgotaNachVodaData',
                    address_id: values.get('address_id'),
                    data:Ext.Date.format(selected[0].data.data,"Ymd"),
                    login:values.get('login'),
                    password:values.get('password')
                },
                scope:this
            });
        }
    },

    onGrLgotaNachVodaSelectionChange: function(model, selected, eOpts) {
        var form = Ext.getCmp('tabFmAppVoda');
        if (selected.length > 0) {
            form.getForm().findField('msq_lgota').setValue(selected[0].data.info);

        }

    },

    onGrNachStokiSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StLgotaNachVoda = Ext.data.StoreManager.get("StLgotaNachVoda");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppStoki');
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            StLgotaNachVoda.load({
                params: {
                    what:'LgotaNachStokiData',
                    address_id: values.get('address_id'),
                    data:Ext.Date.format(selected[0].data.data,"Ymd"),
                    login:values.get('login'),
                    password:values.get('password')
                },
                scope:this
            });
        }
    },

    onGrLgotaNachStokiSelectionChange: function(model, selected, eOpts) {
        var form = Ext.getCmp('tabFmAppStoki');
        if (selected.length > 0) {
            form.getForm().findField('msq_lgota').setValue(selected[0].data.info);

        }
    },

    onGrNachPodogrevSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StLgotaNachVoda = Ext.data.StoreManager.get("StLgotaNachVoda");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppPodogrev');
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            StLgotaNachVoda.load({
                params: {
                    what:'LgotaNachPodogrevData',
                    address_id: values.get('address_id'),
                    data:Ext.Date.format(selected[0].data.data,"Ymd"),
                    login:values.get('login'),
                    password:values.get('password')
                },
                scope:this
            });
        }
    },

    onGrLgotaNachPodogrevSelectionChange: function(model, selected, eOpts) {
        var form = Ext.getCmp('tabFmAppPodogrev');
        if (selected.length > 0) {
            form.getForm().findField('msq_lgota').setValue(selected[0].data.info);

        }
    },

    onGrNachOtoplenieSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StLgotaNachVoda = Ext.data.StoreManager.get("StLgotaNachVoda");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppOtoplenie');
        //console.log(selected[0]);
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            StLgotaNachVoda.load({
                params: {
                    what:'LgotaNachOtoplenieData',
                    address_id: values.get('address_id'),
                    data:Ext.Date.format(selected[0].data.data,"Ymd"),
                    login:values.get('login'),
                    password:values.get('password')
                },
                scope:this
            });
        }
    },

    onGrLgotaNachOtoplenieSelectionChange: function(model, selected, eOpts) {
        var form = Ext.getCmp('tabFmAppOtoplenie');
        if (selected.length > 0) {
            form.getForm().findField('msq_lgota').setValue(selected[0].data.info);

        }
    },

    onGrNachTboSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StLgotaNachVoda = Ext.data.StoreManager.get("StLgotaNachVoda");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppTbo');
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            StLgotaNachVoda.load({
                params: {
                    what:'LgotaNachTboData',
                    address_id: values.get('address_id'),
                    data:Ext.Date.format(selected[0].data.data,"Ymd"),
                    login:values.get('login'),
                    password:values.get('password')
                },
                scope:this
            });
        }
    },

    onGrLgotaNachTboSelectionChange: function(model, selected, eOpts) {
        var form = Ext.getCmp('tabFmAppTbo');
        if (selected.length > 0) {
            form.getForm().findField('msq_lgota').setValue(selected[0].data.info);

        }
    },

    onGrNachKvartplataSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StLgotaNachVoda = Ext.data.StoreManager.get("StLgotaNachVoda");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppKvartplata');
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            StLgotaNachVoda.load({
                params: {
                    what:'LgotaNachKvartplataData',
                    address_id: values.get('address_id'),
                    data:Ext.Date.format(selected[0].data.data,"Ymd"),
                    login:values.get('login'),
                    password:values.get('password')
                },
                scope:this
            });
        }
    },

    onGrLgotaNachKvartplataSelectionChange: function(model, selected, eOpts) {
        var form = Ext.getCmp('tabFmAppKvartplata');
        if (selected.length > 0) {
            form.getForm().findField('msq_lgota').setValue(selected[0].data.info);

        }
    },

    onGrTarifHousesPodogrevSelectionChange: function(model, selected, eOpts) {
        //STORE

        var stAddress = Ext.data.StoreManager.get('StAddressOrg');
        var form = Ext.getCmp('fmPodogrev');
        var pnPerer = Ext.getCmp('pnPererPodogrev');
        var btAddPerer = Ext.getCmp('btAddPererPodogrev');
        var viborTarif = Ext.getCmp('cbTarifTeplo');
        var btnNachHouse = Ext.getCmp('btnNachHousePodogrev');
        var tarif = Ext.getCmp('tarTeplo');

        var dt = new Date();
        var lastDay = Ext.Date.getLastDateOfMonth( dt ) ;
        var firstDay = Ext.Date.getFirstDateOfMonth( dt ) ;

        //console.log(selected);
        if (selected.length > 0) {
            //form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            form.getForm().findField('house_id').setValue(selected[0].data.house_id);
            form.getForm().findField('data').setValue(Ext.Date.format(firstDay, 'Y-m-d'));
            form.getForm().findField('sdata').setValue(Ext.Date.format(firstDay, 'Y-m-d'));
            form.getForm().findField('fdata').setValue(Ext.Date.format(lastDay, 'Y-m-d'));
            form.getForm().findField('address_ot').clearValue();
            form.getForm().findField('address_do').clearValue();
            viborTarif.clearValue();
            viborTarif.setDisabled(false);
            btnNachHouse.setDisabled(false);
            tarif.setValue(0);

            stAddress.removeAll();
            stAddress.load({
                params: {
                    what:'AddressFromHousesTarif',
                    what_id: selected[0].data.house_id
                },
                callback: function(records,operation,success){
                    if(success){
                        form.getForm().findField('address_ot').setValue(records[0].get('address_id'));
                        form.getForm().findField('address_do').setValue(records[0].get('address_id'));
                    }

                },
                scope:this
            });

        }
    },

    onGrNachEnergySelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StLgotaNachVoda = Ext.data.StoreManager.get("StLgotaNachVoda");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppEnergy');
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            StLgotaNachVoda.load({
                params: {
                    what:'LgotaNachEnergyData',
                    address_id: values.get('address_id'),
                    data:Ext.Date.format(selected[0].data.data,"Ymd"),
                    login:values.get('login'),
                    password:values.get('password')
                },
                scope:this
            });
        }
    },

    onBtAddLgotaPererClick: function(button, e, eOpts) {
        // in use
        var me = this;
        //CONTROLLER
        var value = button.findParentByType('form').getValues();
        //STORE
        if (value.summa !== "0") {
            var stUser = Ext.data.StoreManager.get("StUser");
            var values =stUser.getAt(0);
            var vibor = values.get('vibor');
            this.getWinAddLgotaPerer().close();
            switch (vibor){
                case 'addLgotaVodaPerer':
                    me.addLgotaPererVoda(value);
                    break;
                case 'addLgotaStokiPerer':
                    me.addLgotaPererStoki(value);
                    break;
                case 'addLgotaEnergyPerer':
                    me.addLgotaPererEnergy(value);
                    break;
                case 'addLgotaOtopleniePerer':
                    me.addLgotaPererOtoplenie(value);
                    break;
                case 'addLgotaKvartplataPerer':
                    me.addLgotaPererKvartplata(value);
                    break;
                case 'addLgotaTboPerer':
                    me.addLgotaPererTbo(value);
                    break;
                case 'addLgotaVoda':
                    me.addLgotaVoda(value);
                    break;
                case 'addLgotaStoki':
                    me.addLgotaStoki(value);
                    break;
                case 'addLgotaEnergy':
                    me.addLgotaEnergy(value);
                    break;
                case 'addLgotaOtoplenie':
                    me.addLgotaOtoplenie(value);
                    break;
                case 'addLgotaKvartplata':
                    me.addLgotaKvartplata(value);
                    break;
                case 'addLgotaTbo':
                    me.addLgotaTbo(value);
                    break;
                case 'editLgotaVoda':
                    me.editLgotaVoda(value);
                    break;
                case 'editLgotaStoki':
                    me.editLgotaStoki(value);
                    break;

                case 'editLgotaOtoplenie':
                    me.editLgotaOtoplenie(value);
                    break;
                case 'editLgotaKvartplata':
                    me.editLgotaKvartplata(value);
                    break;
                case 'editLgotaTbo':
                    me.editLgotaTbo(value);
                    break;
                case 'editLgotaEnergy':
                    me.editLgotaEnergy(value);
                    break;
            }
        } else {
            Ext.MessageBox.show({
                title: 'Контроль данных',
                msg: 'Введите правильную сумму',
                buttons: Ext.MessageBox.OK,
                icon: Ext.MessageBox.ERROR
            });
        }
    },

    onBtUpdKubNormaClick: function(button, e, eOpts) {
        // in use
        var me = this;
        var value = button.findParentByType('form').getValues();

        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            data:value.data,
            what:"update_kubov_norma"
        };


        //LOGIKA

        var myMask= Ext.Msg.show({
            title:'Обновление кубов по норме...',
            msg: 'Обновление кубов по норме.Ожидайте...',
            buttons: Ext.Msg.CANCEL,
            wait: true,
            modal: true,
            icon: Ext.Msg.INFO
        });

        QueryAddress.updateRecords(params,function(results){
            if(results.success==="1"){
                myMask.close();
                Ext.MessageBox.show({
                    title: 'Обновление кубов по норме',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
            } else {
                myMask.close();
                Ext.MessageBox.show({
                    title: 'Обновление кубов по норме',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    onBtAddNachPodogrevClick: function(button, e, eOpts) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            what:"nachislenie_podogrev"
        };


        //LOGIKA

        var myMask= Ext.Msg.show({
            title:'Начисление...',
            msg: 'Начисление подогрева.Ожидайте...',
            buttons: Ext.Msg.CANCEL,
            wait: true,
            modal: true,
            icon: Ext.Msg.INFO
        });

        QueryAddress.updateRecords(params,function(results){
            if(results.success==="1"){
                myMask.close();
                Ext.MessageBox.show({
                    title: 'Начисление подогрева',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
            } else {
                myMask.close();
                Ext.MessageBox.show({
                    title: 'Начисление подогрева',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    onBtAddPererPodogrevClick: function(button, e, eOpts) {
        // in use
        var value = button.findParentByType('form').getValues();
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        //LOGIN & PASSWORD



        //LOGIKA
        var grid = Ext.getCmp('grTarifHousesPodogrev');
        //var store = grid.getStore();
        var gridRowSelectedRecords  = grid.getView().getSelectionModel().getSelection();
        var size = Ext.Object.getSize(gridRowSelectedRecords) ;
        var values =stUser.getAt(0);
        var params =[];
        if (size > 1){
            params = {
                login:values.get('login'),
                password:values.get('password'),
                what:"pereraschet_podogrev",
                allkv:value.allkv,
                tarif_manual:0,
                sdata:value.sdata,
                fdata:value.fdata,
                address_ot:value.address_ot,
                address_do:value.address_do,
                info:value.info
            };
        } else {

            params = {
                login:values.get('login'),
                password:values.get('password'),
                what:"pereraschet_podogrev",
                allkv:value.allkv,
                tarif_manual:value.tarif_manual,
                ch_gv9:value.ch_gv9,
                ch_gv16:value.ch_gv16,
                sdata:value.sdata,
                fdata:value.fdata,
                address_ot:value.address_ot,
                address_do:value.address_do,
                info:value.info
            };
        }
        //console.log(size);

        var res = 1;
        var house = "";
        var myMask = Ext.Msg.show({
            title:'Перерасчет по подогреву',
            msg: 'Выполнение перерасчета.Ожидайте...',
            buttons: Ext.Msg.CANCEL,
            wait: true,
            modal: true,
            icon: Ext.Msg.INFO
        });
        Ext.Object.each(gridRowSelectedRecords, function(key, val, myself) {
            Ext.Object.merge(val.data, params);
            QueryAddress.updateRecords(val.data,function(results){
                // console.log(results);

                if(results.success==="1"){
                    myMask.close();

                    Ext.MessageBox.show({
                        title: 'Перерасчет подогрев',
                        msg: "Перерасчет подогрев выполнен",
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.INFO
                    });
                }  else {
                    house =val.data.house;
                    myMask.close();
                    Ext.MessageBox.show({
                        title: 'Перерасчет подогрев ',
                        msg: "Перерасчет не выполнен по дому "+ house ,
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.ERROR
                    });

                }
            });
        });


    },

    onBtExportBudjetClick: function(button, e, eOpts) {
        // in use
        var value = button.findParentByType('form').getValues();
        //var winExportLgota = Ext.ClassManager.instantiateByAlias('widget.winexportlgota');
        var win = button.findParentByType('window');

        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            what:"ExportEmail"
        };
        //console.log(value);


        Ext.Object.merge(value, params);
        //LOGIKA

        var myMask = Ext.Msg.show({
            title:'Отправка почты...',
            msg: 'Отправка файла по Email.Ожидайте...',
            buttons: Ext.Msg.CANCEL,
            wait: true,
            modal: true,
            icon: Ext.Msg.INFO
        });


        QueryExport.exportToEmail(value,function(results){
            if(results.success){
                myMask.close();
                win.close();
                Ext.MessageBox.show({
                    title: 'Отправка файла по Email',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });

            } else {
                myMask.close();
                win.close();

                Ext.MessageBox.show({
                    title: 'Отправка файла по Email',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });

            }

        });

    },

    onBtControlLgotClick: function(button, e, eOpts) {
        // in use
        var value = button.findParentByType('form').getValues();
        var tabPnCenter =  Ext.getCmp('tabPnCenter');
        var report = 'controlLgot';
        var namereport = 'Контроль льгот';
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var tab = tabPnCenter.child('#'+report);
        if (!tab) {
            tab  = tabPnCenter.add({
                xtype:'tabReportOrg',
                title:namereport,
                id:''+report+''
            });

        }
        var reppan = tab.getComponent(0);
        tabPnCenter.setActiveTab(tab);

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            what:"controlLgot",
            report:report
        };

        //LOGIKA
        Ext.Object.merge(value, params);

        var myMask = Ext.Msg.show({
            title:'Отчеты...',
            msg: 'Загрузка отчета.Ожидайте...',
            buttons: Ext.Msg.CANCEL,
            wait: true,
            modal: true,
            icon: Ext.Msg.INFO
        });

        QueryReport.getResults(value,function(results){
            if (results.success==="1"){
                myMask.close();
                reppan.update(results.content);
                Ext.REPORTCONTENT =results.content;
                Ext.REPORTSQL =results.sql;
                Ext.REPORTTITLE =report;
            }else{
                myMask.close();
                Ext.MessageBox.show({title: namereport,
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }
        });


    },

    onBtControlDbfLgotClick: function(button, e, eOpts) {
        // in use

        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StDbfLgota = Ext.data.StoreManager.get("StDbfLgota");

        //COMPONENT
        var form = button.findParentByType('form');
        var value = form.getValues();

        var tabPnCenter =  Ext.getCmp('tabPnCenter');
        var tab = tabPnCenter.child('#tabDbfLgota');
        var usluga =form.getForm().findField('rbUsluga').inputValue;
        StDbfLgota.proxy.setExtraParam('what', usluga);

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            what:"ExportBudjetEmail"
        };
        //LOGIKA
        Ext.Object.merge(value, params);

        var myMask = Ext.Msg.show({
            title:'Загрузка ДБФ файла',
            msg: 'Загрузка ДБФ файла со списком льготников.Ожидайте...',
            buttons: Ext.Msg.CANCEL,
            wait: true,
            modal: true,
            icon: Ext.Msg.INFO
        });


        QueryAddress.updateRecords(value,function(result){
            if(result.success==="1"){
                StDbfLgota.load({
                    params: {
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            if (!tab) {
                                tab  = tabPnCenter.add({
                                    xtype:'tabDbfLgota'
                                });

                            }
                            myMask.close();
                            tabPnCenter.setActiveTab(tab);

                        }else {
                            myMask.close();

                        }
                    },
                    scope:this
                });

            } else {
                myMask.close();

                Ext.MessageBox.show({
                    title: 'Загрузка ДБФ файла ',
                    msg: result.msg,
                    buttons: Ext.MessageBox.OK,

                    icon: Ext.MessageBox.ERROR
                });

            }
        });

    },

    onBtFixDolgClick: function(button, e, eOpts) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var value = button.findParentByType('form').getValues();
        //console.log(value);
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            what:"fixDolgTeplo",
            fdata:value.fixdata

        };


        //LOGIKA

        var myMask= Ext.Msg.show({
            title:'Фиксация задолженности...',
            msg: 'Фиксация задолженности.Ожидайте...',
            buttons: Ext.Msg.CANCEL,
            wait: true,
            modal: true,
            icon: Ext.Msg.INFO
        });

        QueryAddress.updateRecords(params,function(results){
            if(results.success==="1"){
                myMask.close();
                Ext.MessageBox.show({
                    title: 'Фиксация задолженности',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
            } else {
                myMask.close();
                Ext.MessageBox.show({
                    title: 'Фиксация задолженности',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    onBtEditOplataClick: function(button, e, eOpts) {
        /// in use
        //CONTROLLER
        var value = button.findParentByType('form').getValues();
        var form = button.findParentByType('form');
        var oplata = 0;
        var kvartplata = form.getForm().findField('kvartplata').getValue();
        var otoplenie = form.getForm().findField('otoplenie').getValue();
        var ptn = form.getForm().findField('ptn').getValue();
        var voda = form.getForm().findField('voda').getValue();
        var stoki = form.getForm().findField('stoki').getValue();
        var tbo = form.getForm().findField('tbo').getValue();
        var energy = form.getForm().findField('energy').getValue();
        var rfond = form.getForm().findField('rfond').getValue();
        var vaxta = form.getForm().findField('vaxta').getValue();

        var summa = parseFloat(form.getForm().findField('summa').getValue()).toFixed(2);
        oplata =parseFloat(kvartplata + otoplenie + ptn + voda + stoki + tbo + energy + rfond+ vaxta).toFixed(2);
        //console.log(summa);
        //console.log(oplata);

        if(summa === oplata) {
            if (summa !== "0") {
                var stUser = Ext.data.StoreManager.get("StUser");
                var values =stUser.getAt(0);
                var vibor = values.get('vibor');
                this.getWinEditOplata().close();
                this.editOplataApp(value);

            } else {
                Ext.MessageBox.show({
                    title: 'Контроль данных',
                    msg: 'Оплата равна 0',
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        } else {
            Ext.MessageBox.show({
                title: 'Контроль данных',
                msg: 'Не совпадают правая и левая части оплаты',
                buttons: Ext.MessageBox.OK,
                icon: Ext.MessageBox.ERROR
            });
        }
    },

    onBtEditDbfLgotaClick: function(button, e, eOpts) {



        var value = button.findParentByType('form').getValues();
        var dataNachDbfLgota = Ext.getCmp('dataNachDbfLgota');

        var form = button.findParentByType('form');
        var StDbfLgota = Ext.data.StoreManager.get("StDbfLgota");
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var vibor = value.vibor;
        this.getWinEditDbfLgota().close();
        var what = "editDbfLgota";

        switch (vibor) {
            case "add":
                what = "addDbfLgota";
                break;
            case "edit":
                what ="editDbfLgota";
        }

        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            osmd_id: values.get('osmd_id'),
            what:what
        };

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  по оплате',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StDbfLgota.load({
                    params: {
                        login:values.get('login'),
                        password:values.get('password'),
                        data:dataNachDbfLgota.getValue(),
                        osmd_id: values.get('osmd_id'),
                        what:"getDbfLgota"

                    },

                    scope:this
                });

            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  по оплате',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });


    },

    onGrNachVaxtaSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppVaxta');
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);

        }
    },

    onTabSubsUtsznActivate: function(component, eOpts) {
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');
        var form = Ext.getCmp('fmSubsUtszn');
        var dt = new Date();
        var usluga_id = form.getForm().findField('usluga_id').getValue();
        var osmd_id = form.getForm().findField('osmd_id').getValue();
        var data_nach = form.getForm().findField('data_nach').getValue();

        if(usluga_id && osmd_id) {

            var grid = Ext.getCmp('grSubsUtszn');
            var store = grid.getStore();
            var btnGetLgotaUtszn =  Ext.getCmp('btnGetSubsidiaUtszn');
            var btnPrintLgotaUtszn =  Ext.getCmp('btnPrintSubsidiaUtszn');
            var btSubsInsOplata =  Ext.getCmp('btSubsInsOplata');
            var btnSubsidiaOtkatOplata =  Ext.getCmp('btnSubsidiaOtkatOplata');

            btnGetLgotaUtszn.setDisabled(false);
            btnPrintLgotaUtszn.setDisabled(false);
            btSubsInsOplata.setDisabled(false);
            btnSubsidiaOtkatOplata.setDisabled(false);

            store.load({
                params: {
                    what:'getSubsidiaUtszn',
                    login:login,
                    password:password,
                    data:data_nach,
                    osmd_id: osmd_id,
                    usluga_id: usluga_id
                },
                scope:this
            });

        }
    },

    onTabLgotaUtsznActivate: function(component, eOpts) {
        var usluga_id = 0;
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');
        var form = Ext.getCmp('fmLgotaUtszn');
        var usluga_id = form.getForm().findField('usluga_id').getValue();
        var osmd_id = form.getForm().findField('osmd_id').getValue();

        var dt = new Date();
        var firstDay =Ext.Date.add(dt, Ext.Date.DAY, -10);
        var data_nach = form.getForm().findField('data_nach').getValue();



        if(usluga_id && osmd_id) {
            var grid = Ext.getCmp('grLgotaUtszn');
            var store = grid.getStore();
            var btnGetLgotaUtszn =  Ext.getCmp('btnGetLgotaUtszn');
            var btnPrintLgotaUtszn =  Ext.getCmp('btnPrintLgotaUtszn');
            var btnPrintLgotaForma3 =  Ext.getCmp('btnPrintLgotaForma3');
            var btnPrintLgotaReestrUtszn =  Ext.getCmp('btnPrintLgotaReestrUtszn');
            var btnInsLgotaOplata =  Ext.getCmp('btnInsLgotaOplata');
            var btnOtkatLgotaOplata =  Ext.getCmp('btnOtkatLgotaOplata');

            btnGetLgotaUtszn.setDisabled(false);
            btnPrintLgotaUtszn.setDisabled(false);
            btnPrintLgotaForma3.setDisabled(false);
            btnPrintLgotaReestrUtszn.setDisabled(false);
            btnInsLgotaOplata.setDisabled(false);
            btnOtkatLgotaOplata.setDisabled(false);

            store.load({
                params: {
                    what:'getLgotaUtszn',
                    login:login,
                    password:password,
                    data:data_nach,
                    osmd_id: osmd_id,
                    usluga_id: usluga_id
                },
                scope:this
            });
        }
    },

    onGrNachPtnSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StLgotaNachVoda = Ext.data.StoreManager.get("StLgotaNachVoda");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppPtn');
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);
            StLgotaNachVoda.load({
                params: {
                    what:'LgotaNachPtnData',
                    address_id: values.get('address_id'),
                    data:Ext.Date.format(selected[0].data.data,"Ymd"),
                    login:values.get('login'),
                    password:values.get('password')
                },
                scope:this
            });
        }
    },

    onGrNachRfondSelectionChange: function(model, selected, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var form = Ext.getCmp('tabFmAppRfond');
        if (selected.length > 0) {
            form.getForm().reset();
            form.getForm().loadRecord(selected[0]);

        }
    },

    addLgotaPererVoda: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppVoda');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaPererVoda"
        };

        //GRID
        var grNach = Ext.getCmp('grNachVoda');

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'VodaApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(0);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaPererStoki: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppStoki');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaPererStoki"
        };

        //GRID
        var grNach = Ext.getCmp('grNachStoki');

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'StokiApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(0);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaPererEnergy: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppEnergy');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaPererEnergy"
        };

        //GRID
        var grNach = Ext.getCmp('grNachEnergy');

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'EnergyApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(0);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaPererOtoplenie: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppOtoplenie');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaPererOtoplenie"
        };

        //GRID
        var grNach = Ext.getCmp('grNachOtoplenie');
        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'OtoplenieApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(0);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaPererKvartplata: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppKvartplata');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaPererKvartplata"
        };

        //GRID
        var grNach = Ext.getCmp('grNachKvartplata');

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'KvartplataApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(0);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaPererTbo: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppTbo');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaPererTbo"
        };

        //GRID
        var grNach = Ext.getCmp('grNachTbo');

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'TboApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(0);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод перерасчета на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    editLgotaVoda: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppVoda');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"editLgotaVoda"
        };

        //GRID
        var grNach = Ext.getCmp('grNachVoda');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'VodaApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    editLgotaEnergy: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppEnergy');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"editLgotaEnergy"
        };

        //GRID
        var grNach = Ext.getCmp('grNachEnergy');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'EnergyApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    editLgotaStoki: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppStoki');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"editLgotaStoki"
        };

        //GRID
        var grNach = Ext.getCmp('grNachStoki');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'StokiApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    editLgotaPodogrev: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppPodogrev');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"editLgotaPodogrev"
        };

        //GRID
        var grNach = Ext.getCmp('grNachPodogrev');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'PodogrevApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    editLgotaOtoplenie: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppOtoplenie');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"editLgotaOtoplenie"
        };

        //GRID
        var grNach = Ext.getCmp('grNachOtoplenie');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'OtoplenieApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    editLgotaKvartplata: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppKvartplata');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"editLgotaKvartplata"
        };

        //GRID
        var grNach = Ext.getCmp('grNachKvartplata');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'KvartplataApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    editLgotaTbo: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppTbo');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"editLgotaTbo"
        };

        //GRID
        var grNach = Ext.getCmp('grNachTbo');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'TboApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaVoda: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppVoda');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaVoda"
        };

        //GRID
        var grNach = Ext.getCmp('grNachVoda');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA
        Ext.Object.merge(value, params);
        //console.log(value.ind);

        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'VodaApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaStoki: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppStoki');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaStoki"
        };

        //GRID
        var grNach = Ext.getCmp('grNachStoki');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'StokiApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaEnergy: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppEnergy');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaEnergy"
        };

        //GRID
        var grNach = Ext.getCmp('grNachEnergy');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'EnergyApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaOtoplenie: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppOtoplenie');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaOtoplenie"
        };

        //GRID
        var grNach = Ext.getCmp('grNachOtoplenie');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'OtoplenieApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaKvartplata: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppKvartplata');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaKvartplata"
        };

        //GRID
        var grNach = Ext.getCmp('grNachKvartplata');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'KvartplataApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    addLgotaTbo: function(value) {
        // in use
        var me = this;
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTekNachApp = Ext.data.StoreManager.get("StTekNachApp");
        var form = Ext.getCmp('tabFmAppTbo');

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            address_id:values.get('address_id'),
            address:values.get('address'),
            what:"addLgotaTbo"
        };

        //GRID
        var grNach = Ext.getCmp('grNachTbo');
        var valueNachisl  = grNach.getView().getSelectionModel().getSelection()[0];
        var ind  = grNach.getView().getStore().indexOf(valueNachisl);

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StTekNachApp.load({
                    params: {
                        what:'TboApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    callback: function(records,operation,success){
                        if(success){
                            grNach.getView().getSelectionModel().select(ind);

                        }else{
                            form.getForm().reset();
                        }
                    },
                    scope:this
                });


            } else {
                Ext.MessageBox.show({
                    title: 'Ввод начисления на бюджет',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });
    },

    importZarplataPort: function() {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        //console.log(stUser);

        var StPort = Ext.data.StoreManager.get("StPort");
        //LOGIN & PASSWORD
        var values =stUser.getAt(0);

        StPort.load({
            params: {
                what:'port',
                login:values.get('login'),
                password:values.get('password')
            }
        });


    },

    editOplataApp: function(value) {
        // in use
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StOplata = Ext.data.StoreManager.get("StOplata");

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            what:"editOplataApp"
        };

        //LOGIKA

        Ext.Object.merge(value, params);
        QueryAddress.updateRecords(value,function(results){
            if(results.success==="1"){
                Ext.MessageBox.show({
                    title: 'Редактирование записи  по оплате',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.INFO
                });
                StOplata.load({
                    params: {
                        what:'OplataApp',
                        address_id: values.get('address_id'),
                        login:values.get('login'),
                        password:values.get('password')
                    },
                    scope:this
                });
            } else {
                Ext.MessageBox.show({
                    title: 'Редактирование записи  по оплате',
                    msg: results.msg,
                    buttons: Ext.MessageBox.OK,
                    icon: Ext.MessageBox.ERROR
                });
            }

        });

    }

});
