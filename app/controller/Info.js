/*
 * File: app/controller/Info.js
 *
 * This file was generated by Sencha Architect version 3.2.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 5.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 5.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('Osbb.controller.Info', {
    extend: 'Ext.app.Controller',

    refs: {
        WinReport: {
            autoCreate: true,
            selector: 'winReport',
            xtype: 'winreport'
        },
        TabPnCenter: '#tabPnCenter'
    },

    control: {
        "#btnWinReportOrg": {
            click: 'onBtnWinReportOrgClick'
        },
        "#winReport": {
            show: 'onWinReportShow'
        },
        "#treeMenuSprav": {
            itemclick: 'onTreeMenuSpravItemClick'
        },
        "#tabMVodomer": {
            activate: 'onTabMVodomerActivate'
        },
        "#tabMTeplomer": {
            activate: 'onTabMTeplomerActivate'
        },
        "#btnPrintLgotnikAll": {
            click: 'onBtnPrintLgotnikAllClick'
        },
        "#btnPrintLgotnikEnd": {
            click: 'onBtnPrintLgotnikEndClick'
        },
        "#btnPrintLgotnikIzm": {
            click: 'onBtnPrintLgotnikIzmClick'
        },
        "#btnPrintLgotnikHouse": {
            click: 'onBtnPrintLgotnikHouseClick'
        },
        "#btnPrintLgotnikLgota": {
            click: 'onBtnPrintLgotnikLgotaClick'
        },
        "#btnPrintLgotnikGroup": {
            click: 'onBtnPrintLgotnikGroupClick'
        },
        "#btnFilialAccount": {
            click: 'onBtnFilialAccountClick'
        },
        "#btnAktSverkiFilialVik": {
            click: 'onBtnAktSverkiFilialVikClick'
        },
        "#printRaspechatakaVoda": {
            click: 'onPrintRaspechatakaVodaClick'
        },
        "#printRaspechatakaYtke": {
            click: 'onPrintRaspechatakaYtkeClick'
        },
        "#printRaspechatakaTbo": {
            click: 'onPrintRaspechatakaTboClick'
        },
        "#printRaspechatakaEnergy": {
            click: 'onPrintRaspechatakaEnergyClick'
        },
        "#printRaspechatakaGas": {
            click: 'onPrintRaspechatakaGasClick'
        },
        "#printRaspechatakaVaxta": {
            click: 'onPrintRaspechatakaVaxtaClick'
        },
        "#printRaspechatakaKvartplata": {
            click: 'onPrintRaspechatakaKvartplataClick'
        },
        "#tabHouseResidents": {
            activate: 'onTabHouseResidentsActivate'
        },
        "#printRaspechatakaPtn": {
            click: 'onPrintRaspechatakaPtnClick'
        },
        "#printRaspechatakaTeplo": {
            click: 'onPrintRaspechatakaTeploClick'
        }
    },

    onBtnWinReportOrgClick: function(button, e, eOpts) {
        var me = this;
        me.tabOtSvNach();

    },

    onWinReportShow: function(component, eOpts) {
        var me = this;
        var stUser = Ext.data.StoreManager.get("StUser");
        var stOrg = Ext.data.StoreManager.get("StOrg");

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');
        var namereport = values.get('namereport');
        var report = values.get('report');
        var house_id = values.get('house_id');
        var osmd_id = values.get('osmd_id');


        var prixod_id = values.get('prixod_id');

        var form = Ext.getCmp('fmWinReport');
        var cbOsmd = form.getForm().findField('osmd_id');


        var header = Ext.getCmp('headerReport');
        var fsDolg = Ext.getCmp('fsDolg');


        var fsGetPeriod = Ext.getCmp('fsGetPeriod');
        var btnWinReportOrg = Ext.getCmp('btnWinReportOrg');

        var winReport = me.getWinReport();
        var chkRazv = Ext.getCmp('chkRazv');

        var chkRepCat = Ext.getCmp('chkRepCat');
        var chkRepRaion = Ext.getCmp('chkRepRaion');
        var chkRepCity = Ext.getCmp('chkRepCity');
        var chkRepHouse = Ext.getCmp('chkRepHouse');
        var chkRepOrg = Ext.getCmp('chkRepOrg');
        var chkGrLgota = Ext.getCmp('chkGrLgota');
        var cbRepGrLgota = Ext.getCmp('cbRepGrLgota');
        var cbPrixod = Ext.getCmp('cbPrixod');
        var dateRepFrom = Ext.getCmp('dateRepFrom');
        var dateRepTo = Ext.getCmp('dateRepTo');
        var fieldKassir = Ext.getCmp('fieldKassir');


        header.setText(namereport).show();


        var dt = new Date();
        var dt_y =  Ext.Date.format(dt, 'Y');
        var dt_m = Ext.Date.format(dt, 'm');
        var dt_d = Ext.Date.format(dt, 'd');
        var from = new Date(dt_m+"/"+dt_d +"/"+dt_y);
        dateRepFrom.setValue(Ext.Date.getFirstDateOfMonth(from, 'Y-m-d'));
        dateRepTo.setValue(Ext.Date.getLastDateOfMonth(from, 'Y-m-d'));

        switch (report) {

            case 'FlatRaspechatka':
            case 'InfoHouse':
            case 'ItogMonthKv':
            case 'ItogMonthVaxta':
            case 'ItogMonthRfond':

            case 'ItogMonthVoda':
            case 'ItogMonth':
            case 'ItogMonthTeplo':
            case 'ItogMonthTbo':
            case 'ItogMonthEnergy':
            case 'NachislenoAllKv':
            case 'NachislenoAllVaxta':
            case 'NachislenoAllRfond':

            case 'NachislenoAllVoda':
            case 'NachislenoAllTeplo':
            case 'NachislenoAllPtn':
            case 'ListOnPay':
            case 'courseMapEn':
            case 'courseMapVoda':


            case 'NachislenoAllTbo':
            case 'NachislenoAllEnergy':
                if (!cbOsmd.isHidden()){cbOsmd.hide();}
                if (chkRepHouse.isHidden()){chkRepHouse.show();}
                if (!chkGrLgota.isHidden()){chkGrLgota.hide();}
                if (!btnWinReportOrg.isHidden()){btnWinReportOrg.hide();}
                break;

            case 'ItogBudjetPoGroupSvOsmd':
            case 'AppHistory':
            case 'reportLgotnik':
            case 'KassaAddressOsmd':
            case 'KassaPrixodOsmd':
            case 'KassaDateOsmd':

                if (cbOsmd.isHidden()){cbOsmd.show();}
                if (!chkRepHouse.isHidden()){chkRepHouse.hide();}
                if (!chkGrLgota.isHidden()){chkGrLgota.hide();}
                if (!btnWinReportOrg.isHidden()){btnWinReportOrg.hide();}
                break;

            case 'ItogBudjetPoGroupRazvOsmd':

                if (cbOsmd.isHidden()){cbOsmd.show();}
                if (cbRepGrLgota.isHidden()){cbRepGrLgota.show();}
                if (!chkRepHouse.isHidden()){chkRepHouse.hide();}
                if (!btnWinReportOrg.isHidden()){btnWinReportOrg.hide();}
                break;
            case 'ItogBudjetPoGroupRazv':

                if (!cbOsmd.isHidden()){cbOsmd.hide();}
                if (cbRepGrLgota.isHidden()){cbRepGrLgota.show();}
                if (!chkRepHouse.isHidden()){chkRepHouse.hide();}
                if (!btnWinReportOrg.isHidden()){btnWinReportOrg.hide();}
                break;
            case 'ControlVoda':
            case 'ControlTeplo':
            case 'ControlPtn':

            case 'ControlKv':
            case 'ControlCubov':

            case 'ControlVaxta':
            case 'ControlTbo':
            case 'ControlEnergy':
            case 'ControlGas':


                if (cbOsmd.isHidden()){cbOsmd.hide();}
                if (!chkRepHouse.isHidden()){chkRepHouse.hide();}
                if (!chkGrLgota.isHidden()){chkGrLgota.hide();}
                if (!btnWinReportOrg.isHidden()){btnWinReportOrg.show();}

                break;
            case 'PrintSubsUtsznAll':

                if (!cbOsmd.isHidden()){cbOsmd.hide();}
                if (!chkRepHouse.isHidden()){chkRepHouse.hide();}
                if (!chkGrLgota.isHidden()){chkGrLgota.hide();}
                break;
            case 'Dolgi':
            case 'Warning':
                if (fsDolg.isHidden()){fsDolg.show();}
                if (!btnWinReportOrg.isHidden()){btnWinReportOrg.hide();}
                if (cbOsmd.isHidden()){cbOsmd.hide();}
                if (chkRepHouse.isHidden()){chkRepHouse.show();}
                if (!chkGrLgota.isHidden()){chkGrLgota.hide();}
                if (!cbRepGrLgota.isHidden()){cbRepGrLgota.hide();}

                break;
            case 'DolgiSubsid':

                if (fsDolg.isHidden()){fsDolg.show();}
                if (!btnWinReportOrg.isHidden()){btnWinReportOrg.hide();}
                if (!chkRepCat.isHidden()){chkRepCat.hide();}
                if (chkRepCity.isHidden()){chkRepCity.show();}
                if (chkRepRaion.isHidden()){chkRepRaion.hide();}
                if (chkRepHouse.isHidden()){chkRepHouse.hide();}
                if (!chkRepOrg.isHidden()){chkRepOrg.hide();}
                if (!chkGrLgota.isHidden()){chkGrLgota.hide();}
                if (!cbRepGrLgota.isHidden()){cbRepGrLgota.hide();}

                break;



        }

    },

    onTreeMenuSpravItemClick: function(dataview, record, item, index, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');
        //LOGIKA
        var parentId = record.data.parentId;
        var id = record.data.id;
        var text = record.data.text;
        var qtip = record.data.text;
        switch (id) {
                //////////////////////////// ЖИЛОЙ ФОНД
            case 'tabNewAddress':
            case 'tabWaterHouse':
            case 'tabSubsidia':
            case 'tabVozvratSubsidia':

                /////////////////////////// СПРАВОЧНИКИ
            case 'tabLgota':
            case 'tabNormRashVoda':

            case 'tabPayment':
            case 'tabTemp':
            case 'tabWorkGrafik':
            case 'tabMVodomer':
            case 'tabMTeplomer':
            case 'tabPrivatBank':

            case 'tabMEnergomer':
            case 'tabMGasomer':
            case 'tabCatSobstv':
            case 'tabSprTypeHot':
            case 'tabPrixod':


                ///////////////////////////////БЮДЖЕТ
            case 'tabDbfLgota':
            case 'tabLgotnik':
            case 'tabLgotaUtszn':
            case 'tabSubsUtszn':

                ///////////////////////////////ЮЖТРАНС
            case 'tabTbo':
            case 'tabEnergy':


                ///////////////////////////// МЖКЦ
            case 'tabKvartplata':
            case 'tabVaxta':
            case 'tabRfond':



                //////////////////////////////////КП ВиК
            case 'tabVoda':
            case 'tabOrg':



                //////////////////////////////////КП ЮТКЕ
            case 'tabOtoplenie':
                values.set({
                    'parentid':parentId,
                    'sprav':id,
                    'namesprav':text,
                    'spravheader':qtip
                });
                me.openSprav(id, text);
                break;
            case 'tabHouseResidents':
                values.set({
                    'parentid':parentId,
                    'sprav':id,
                    'namesprav':text,
                    'vibor':record.data.text,
                    'spravheader':qtip
                });
                me.openSprav(id, text);
                break;
                //////////////////////////// ЖИЛОЙ ФОНД
            case 'AppHistory':
                //   case 'LgotnikData':

                ///////////////////////////////КП ГЖК
            case 'ItogMonth':
            case 'Dolgi':
            case 'DolgiSubsid':
            case 'Warning':

                ///////////////////////////////ТБО

            case 'ItogMonthTbo':
            case 'NachislenoAllTbo':
                ///////////////////////////////Электроэнергия
            case 'ItogMonthEnergy':
            case 'NachislenoAllEnergy':
            case 'ListOnPay':

                ///////////////////////////// Квартплата

            case 'ItogMonthKv':
            case 'ControlVoda':
            case 'ControlTeplo':
            case 'ControlPtn':

            case 'ControlKv':
            case 'ControlVaxta':
            case 'ControlTbo':
            case 'ControlGas':
            case 'ControlEnergy':
            case 'ControlCubov':
            case 'PrintSubsUtsznAll':

            case 'NachislenoAllKv':
            case 'ItogMonthVaxta':
            case 'ItogMonthRfond':

            case 'NachislenoAllVaxta':
            case 'NachislenoAllRfond':

            case 'NachislenoAllPtn':
            case 'InfoOsmd':
            case 'courseMapEn':
            case 'courseMapVoda':

            case 'InfoHouse':
            case 'KassaAddressOsmd':
            case 'KassaPrixodOsmd':
            case 'KassaDateOsmd':

                ///////////////////////////////БЮДЖЕТ
            case 'ItogBudjetPoGroupSv':
            case 'ItogBudjetPoGroupRazv':
            case 'ItogBudjetPoGroupSvOsmd':
            case 'ItogBudjetPoGroupRazvOsmd':

                ///////////////////////////////// Отопление
            case 'ItogMonthTeplo':
            case 'SvodOtNasel':
            case 'YkteHistoryGkal':
            case 'NachislenoAllTeplo':

                //////////////////////////////////Вода
            case 'ItogMonthVoda':
            case 'NachislenoAllVoda':
            case 'VikVodHouses':



                values.set({
                    'report':id,
                    'namereport':text,
                    'reportheader':text
                });
                winReport.show();
                break;
        }

    },

    onTabMVodomerActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StVmodel = Ext.data.StoreManager.get("StVmodel");

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);


        //LOGIKA
        StVmodel.load({
            params: {
                what:'getVmodel',
                login:values.get('login'),
                password:values.get('password')
            },
            scope:this
        });
    },

    onTabMTeplomerActivate: function(component, eOpts) {
        //STORE
        var stUser = Ext.data.StoreManager.get("StUser");
        var StTmodel = Ext.data.StoreManager.get("StTmodel");

        //LOGIN & PASSWORD
        var values =stUser.getAt(0);


        //LOGIKA
        StTmodel.load({
            params: {
                what:'getTmodel',
                login:values.get('login'),
                password:values.get('password')
            },
            scope:this
        });
    },

    onBtnPrintLgotnikAllClick: function(button, e, eOpts) {
        //in use
        var me = this;
        var StUser = Ext.data.StoreManager.get("StUser");
        var values =StUser.getAt(0);

        var dataTabLgotnikEnd = Ext.getCmp('dataTabLgotnikEnd').getValue();
        // console.log(dataTabLgotnikEnd);


        if (dataTabLgotnikEnd) {
            var data_from = Ext.Date.getFirstDateOfMonth(dataTabLgotnikEnd);
            var data_to = Ext.Date.getLastDateOfMonth(dataTabLgotnikEnd);

            var usertype = 1;

            var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();

            var report = 'reportLgotnik';
            var namereport = 'Список льготников';
            var value = {
                login:values.get('login'),
                password:values.get('password'),
                report:report,
                what:report,
                date_from:data_from,
                date_to:data_to
            };
            var tab = tabPnCenter.child('#'+report);
            if (!tab) {
                tab  = tabPnCenter.add({
                    xtype:'tabreportorg',
                    title:namereport,
                    id:''+report+''
                });

            }
            //console.log(value);

            tabPnCenter.setActiveTab(tab);
            var reppan = tab.getComponent(0);
            // Basic mask:
            var myMask= Ext.Msg.show({
                title:'Загрузка...',
                msg: 'Загрузка отчета .Ожидайте...',
                buttons: Ext.Msg.CANCEL,
                wait: true,
                modal: true,
                icon: Ext.Msg.INFO
            });
            QueryReport.getResults(value,function(data){
                if (data){
                    reppan.update(data.content);
                    Ext.REPORTCONTENT =data.content;
                    Ext.REPORTSQL =data.sql;
                    Ext.REPORTTITLE =report;
                    myMask.close();

                } else {
                    myMask.close();
                    Ext.MessageBox.show({
                        title: 'Ошибка ',
                        msg: 'Документ не создан',
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.ERROR
                    });
                }
            });

        }
    },

    onBtnPrintLgotnikEndClick: function(button, e, eOpts) {
        //in use
        var me = this;
        var StUser = Ext.data.StoreManager.get("StUser");
        var values =StUser.getAt(0);

        var dataTabLgotnikEnd = Ext.getCmp('dataTabLgotnikEnd').getValue();
           // console.log(dataTabLgotnikEnd);


        if (dataTabLgotnikEnd) {
           var data_from = Ext.Date.getFirstDateOfMonth(dataTabLgotnikEnd);
           var data_to = Ext.Date.getLastDateOfMonth(dataTabLgotnikEnd);

        var usertype = 1;

        var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();

            var report = 'reportLgotnikEnd';
            var namereport = 'Контроль льготников';
            var value = {
                login:values.get('login'),
                password:values.get('password'),
                report:report,
                what:report,
                date_from:data_from,
                date_to:data_to
            };
            var tab = tabPnCenter.child('#'+report);
            if (!tab) {
                tab  = tabPnCenter.add({
                    xtype:'tabreportorg',
                    title:namereport,
                    id:''+report+''
                });

            }
            //console.log(value);

            tabPnCenter.setActiveTab(tab);
            var reppan = tab.getComponent(0);
            // Basic mask:
            var myMask= Ext.Msg.show({
                title:'Загрузка...',
                msg: 'Загрузка отчета .Ожидайте...',
                buttons: Ext.Msg.CANCEL,
                wait: true,
                modal: true,
                icon: Ext.Msg.INFO
            });
            QueryReport.getResults(value,function(data){
                if (data){
                    reppan.update(data.content);
                    Ext.REPORTCONTENT =data.content;
                    Ext.REPORTSQL =data.sql;
                    Ext.REPORTTITLE =report;
                    myMask.close();

                } else {
                    myMask.close();
                    Ext.MessageBox.show({
                        title: 'Ошибка ',
                        msg: 'Документ не создан',
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.ERROR
                    });
                }
            });

        }
    },

    onBtnPrintLgotnikIzmClick: function(button, e, eOpts) {
        //in use
        var me = this;
        var StUser = Ext.data.StoreManager.get("StUser");
        var values =StUser.getAt(0);

        var dataTabLgotnikIzm = Ext.getCmp('dataTabLgotnik').getValue();
           // console.log(dataTabLgotnikEnd);


        if (dataTabLgotnikIzm) {
           var data_from = Ext.Date.getFirstDateOfMonth(dataTabLgotnikIzm);
           var data_to = Ext.Date.getLastDateOfMonth(dataTabLgotnikIzm);

        var usertype = 1;

        var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();

            var report = 'reportLgotnikIzm';
            var namereport = 'Изменения льготников';
            var value = {
                login:values.get('login'),
                password:values.get('password'),
                report:report,
                what:report,
                date_from:data_from,
                date_to:data_to
            };
            var tab = tabPnCenter.child('#'+report);
            if (!tab) {
                tab  = tabPnCenter.add({
                    xtype:'tabreportorg',
                    title:namereport,
                    id:''+report+''
                });

            }
            //console.log(value);

            tabPnCenter.setActiveTab(tab);
            var reppan = tab.getComponent(0);
            // Basic mask:
            var myMask= Ext.Msg.show({
                title:'Загрузка...',
                msg: 'Загрузка отчета .Ожидайте...',
                buttons: Ext.Msg.CANCEL,
                wait: true,
                modal: true,
                icon: Ext.Msg.INFO
            });
            QueryReport.getResults(value,function(data){
                if (data){
                    reppan.update(data.content);
                    Ext.REPORTCONTENT =data.content;
                    Ext.REPORTSQL =data.sql;
                    Ext.REPORTTITLE =report;
                    myMask.close();

                } else {
                    myMask.close();
                    Ext.MessageBox.show({
                        title: 'Ошибка ',
                        msg: 'Документ не создан',
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.ERROR
                    });
                }
            });

        }
    },

    onBtnPrintLgotnikHouseClick: function(button, e, eOpts) {
        //in use
        var me = this;
        var StUser = Ext.data.StoreManager.get("StUser");
        var values =StUser.getAt(0);

        var house_id = Ext.getCmp('cbTabLgotnikHouse').getValue();
           // console.log(dataTabLgotnikEnd);


        if (house_id) {

        var usertype = 1;

        var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();

            var report = 'reportLgotnikHouse';
            var namereport = 'Льготников по дому';
            var value = {
                login:values.get('login'),
                password:values.get('password'),
                report:report,
                what:report,
                house_id:house_id
            };
            var tab = tabPnCenter.child('#'+report);
            if (!tab) {
                tab  = tabPnCenter.add({
                    xtype:'tabreportorg',
                    title:namereport,
                    id:''+report+''
                });

            }
            //console.log(value);

            tabPnCenter.setActiveTab(tab);
            var reppan = tab.getComponent(0);
            // Basic mask:
            var myMask= Ext.Msg.show({
                title:'Загрузка...',
                msg: 'Загрузка отчета .Ожидайте...',
                buttons: Ext.Msg.CANCEL,
                wait: true,
                modal: true,
                icon: Ext.Msg.INFO
            });
            QueryReport.getResults(value,function(data){
                if (data){
                    reppan.update(data.content);
                    Ext.REPORTCONTENT =data.content;
                    Ext.REPORTSQL =data.sql;
                    Ext.REPORTTITLE =report;
                    myMask.close();

                } else {
                    myMask.close();
                    Ext.MessageBox.show({
                        title: 'Ошибка ',
                        msg: 'Документ не создан',
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.ERROR
                    });
                }
            });

        }
    },

    onBtnPrintLgotnikLgotaClick: function(button, e, eOpts) {
        //in use
        var me = this;
        var StUser = Ext.data.StoreManager.get("StUser");
        var values =StUser.getAt(0);

        var lgota_id = Ext.getCmp('cbTabLgotnikLgota').getValue();
           // console.log(dataTabLgotnikEnd);


        if (lgota_id) {

        var usertype = 1;

        var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();

            var report = 'reportLgotnikLgota';
            var namereport = 'Льготников по льготе';
            var value = {
                login:values.get('login'),
                password:values.get('password'),
                report:report,
                what:report,
                lgota_id:lgota_id
            };
            var tab = tabPnCenter.child('#'+report);
            if (!tab) {
                tab  = tabPnCenter.add({
                    xtype:'tabreportorg',
                    title:namereport,
                    id:''+report+''
                });

            }
            //console.log(value);

            tabPnCenter.setActiveTab(tab);
            var reppan = tab.getComponent(0);
            // Basic mask:
            var myMask= Ext.Msg.show({
                title:'Загрузка...',
                msg: 'Загрузка отчета .Ожидайте...',
                buttons: Ext.Msg.CANCEL,
                wait: true,
                modal: true,
                icon: Ext.Msg.INFO
            });
            QueryReport.getResults(value,function(data){
                if (data){
                    reppan.update(data.content);
                    Ext.REPORTCONTENT =data.content;
                    Ext.REPORTSQL =data.sql;
                    Ext.REPORTTITLE =report;
                    myMask.close();

                } else {
                    myMask.close();
                    Ext.MessageBox.show({
                        title: 'Ошибка ',
                        msg: 'Документ не создан',
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.ERROR
                    });
                }
            });

        }
    },

    onBtnPrintLgotnikGroupClick: function(button, e, eOpts) {
        //in use
        var me = this;
        var StUser = Ext.data.StoreManager.get("StUser");
        var values =StUser.getAt(0);

        var gr = Ext.getCmp('cbTabLgotnikGroup').getValue();
          // console.log(gr);


        if (gr) {

        var usertype = 1;

        var tabPnCenter =  Ext.getCmp('tabPnCenter');//me.getTabPnCenter();

            var report = 'reportLgotnikGroup';
            var namereport = 'Льготников по группе';
            var value = {
                login:values.get('login'),
                password:values.get('password'),
                report:report,
                what:report,
                gr:gr
            };
            var tab = tabPnCenter.child('#'+report);
            if (!tab) {
                tab  = tabPnCenter.add({
                    xtype:'tabreportorg',
                    title:namereport,
                    id:''+report+''
                });

            }
            //console.log(value);

            tabPnCenter.setActiveTab(tab);
            var reppan = tab.getComponent(0);
            // Basic mask:
            var myMask= Ext.Msg.show({
                title:'Загрузка...',
                msg: 'Загрузка отчета .Ожидайте...',
                buttons: Ext.Msg.CANCEL,
                wait: true,
                modal: true,
                icon: Ext.Msg.INFO
            });
            QueryReport.getResults(value,function(data){
                if (data){
                    reppan.update(data.content);
                    Ext.REPORTCONTENT =data.content;
                    Ext.REPORTSQL =data.sql;
                    Ext.REPORTTITLE =report;
                    myMask.close();

                } else {
                    myMask.close();
                    Ext.MessageBox.show({
                        title: 'Ошибка ',
                        msg: 'Документ не создан',
                        buttons: Ext.MessageBox.OK,
                        icon: Ext.MessageBox.ERROR
                    });
                }
            });

        }
    },

    onBtnFilialAccountClick: function() {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FilialAccount';
        var text = 'Счет';
        var qtip = 'Счет';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onBtnAktSverkiFilialVikClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'AktSverkiFilialVik';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onPrintRaspechatakaVodaClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaVoda';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onPrintRaspechatakaYtkeClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaTeplo';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onPrintRaspechatakaTboClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaTbo';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onPrintRaspechatakaEnergyClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaEnergy';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onPrintRaspechatakaGasClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaGas';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onPrintRaspechatakaVaxtaClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaVaxta';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onPrintRaspechatakaKvartplataClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaKv';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onTabHouseResidentsActivate: function(component, eOpts) {
        var stUser = Ext.data.StoreManager.get("StUser");
        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');
        var form = Ext.getCmp('fmHouseResidents');




    },

    onPrintRaspechatakaPtnClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaPtn';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    onPrintRaspechatakaTeploClick: function(button, e, eOpts) {
        //in use
        var me = this;

        // STORE

        var stUser = Ext.data.StoreManager.get("StUser");

        //Component

        var winReport = me.getWinReport();

        //LOGIN & PASSWORD

        var values =stUser.getAt(0);
        var login = values.get('login');
        var password = values.get('password');

        //LOGIKA
        var id = 'FlatRaspechatkaTeplo';
        var text = 'Распечатка';
        var qtip = 'Распечатка';

        values.set({
            'report':id,
            'namereport':text,
            'reportheader':text
        });

        winReport.show();

    },

    tabOtSvNach: function() {

        //in use
        var me = this;
        // STORE
        var StUser = Ext.data.StoreManager.get("StUser");
        var StReport = Ext.data.StoreManager.get("StReport");
        //TAB
        var winReport = me.getWinReport();
        var tabPnCenter = me.getTabPnCenter();
        // FORM
        var fmWinReport = Ext.getCmp("fmWinReport");  //Форма
        var value = fmWinReport.getValues();

        //LOGIN & PASSWORD & ID
        var values =StUser.getAt(0);
        var params = {
            login:values.get('login'),
            password:values.get('password'),
            report:values.get('report'),
            vibor:values.get('vibor'),

            what:values.get('report'),
            filial_id:values.get('filial_id'),
            address_id:values.get('address_id')

        };

        var report = values.get('report');
        var namereport = values.get('reportheader');

        //console.log(namereport);


        //LOGIKA

        Ext.Object.merge(value, params);


        var tab = tabPnCenter.child('#'+report);

        if (!tab) {
            tab  = tabPnCenter.add({
                xtype:'tabreportorg',
                title:namereport,
                id:''+report+''
            });

            tabPnCenter.setActiveTab(tab);

        }else{

            tabPnCenter.setActiveTab(tab);
        }

        var reppan = tab.getComponent(0);



        // Basic mask:
        //var myMask = new Ext.LoadMask(winReport, {msg:"Загрузка отчета..."});
        //myMask.show();

        var myMask= Ext.Msg.show({
            title:'Отчеты...',
            msg: 'Загрузка отчета.Ожидайте...',
            buttons: Ext.Msg.CANCEL,
            wait: true,
            modal: true,
            icon: Ext.Msg.INFO
        });

        QueryReport.getResults(value,function(results){
            if (results.success==="1"){
                reppan.update(results.content);
                Ext.REPORTCONTENT =results.content;
                Ext.REPORTSQL =results.sql;
                Ext.REPORTTITLE =report;
                myMask.close();
                winReport.close();

            }else{
                Ext.MessageBox.show({title: namereport,
                                     msg: results.msg,
                                     buttons: Ext.MessageBox.OK,
                                     icon: Ext.MessageBox.ERROR
                                    });
                myMask.close();
                winReport.close();


            }
        });
    },

    openSprav: function(tid, tname) {
        //in use

        var me = this;
        var xt = Ext.util.Format.lowercase(tid);
        var tabPnCenter = me.getTabPnCenter();
        var tab = tabPnCenter.child('#'+tid);
        if (!tab) {
            tab  = tabPnCenter.add({
                xtype:xt,
                id:tid
            });

            tabPnCenter.setActiveTab(tab);
        }else{
            tabPnCenter.setActiveTab(tab);
        }
    }

});
