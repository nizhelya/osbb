{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Kvartplata"
    },
    "name": "MyController",
    "designerId": "a7c199a1-776e-4505-adf9-cddd4697d4c7",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#tabKvartplata",
                "designer|params": [
                    "component",
                    "eOpts"
                ],
                "designer|targetType": "Ext.panel.Panel",
                "fn": "onTabKvartplataActivate",
                "implHandler": [
                    "  var form = Ext.getCmp('fmKvartplata');",
                    "        var btAddNach = Ext.getCmp('btAddNachKv');",
                    "        var grid = Ext.getCmp('grTarifHousesKv');",
                    "        var store = grid.getStore();",
                    "//console.log(store.data);",
                    "        store.removeAll();",
                    "        var dt = new Date();",
                    "        var firstDay = Ext.Date.getFirstDateOfMonth( dt ) ;",
                    "        form.getForm().reset();",
                    "        form.getForm().findField('data_nach').setValue(firstDay);",
                    "        btAddNach.setText(\"Начислить квартплату за период   \"+ Ext.Date.format(firstDay, 'F,Y'));",
                    ""
                ],
                "name": "activate"
            },
            "name": "onTabKvartplataActivate",
            "designerId": "28fde43d-47bf-4d4c-bfcf-a07a285efd9c"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#grTarifHousesKv",
                "designer|params": [
                    "model",
                    "selected",
                    "eOpts"
                ],
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onGrTarifHousesKvSelectionChange",
                "implHandler": [
                    "//STORE",
                    "",
                    "var stAddress = Ext.data.StoreManager.get('StAddressOrg');",
                    "var form = Ext.getCmp('fmKvartplata');",
                    "var btAddPerer = Ext.getCmp('btAddPererKv');",
                    "var btAddPererNachKv = Ext.getCmp('btAddPererNachKv');",
                    "var btAddNachKvPrev = Ext.getCmp('btAddNachKvPrev');",
                    "",
                    "var viborTarif = Ext.getCmp('cbTarifKv');",
                    "var btAddNach = Ext.getCmp('btAddNachKv');",
                    "var btAddNachRemont = Ext.getCmp('btAddNachRemont');",
                    "",
                    "var btAddNachDop = Ext.getCmp('btAddNachDop');",
                    "",
                    "var btnInsTarif = Ext.getCmp('btnInsTarifKv');",
                    "var tarif = Ext.getCmp('tarKv');",
                    "",
                    "var dt = new Date();",
                    "var lastDay = Ext.Date.getLastDateOfMonth( dt ) ;",
                    "var firstDay = Ext.Date.getFirstDateOfMonth( dt ) ;",
                    "",
                    "//console.log(selected);",
                    "if (selected.length > 0) {",
                    "    form.getForm().loadRecord(selected[0]);",
                    "",
                    "    form.getForm().findField('sdata').setValue(Ext.Date.format(Ext.Date.getFirstDateOfMonth(selected[0].data.data), 'Y-m-d'));",
                    "    form.getForm().findField('fdata').setValue(Ext.Date.format( Ext.Date.getLastDateOfMonth(selected[0].data.data), 'Y-m-d'));",
                    "    form.getForm().findField('address_ot').clearValue();",
                    "    form.getForm().findField('address_do').clearValue();",
                    "    form.getForm().findField('allkv').setValue(1);",
                    "    form.getForm().findField('tarif_manual').setValue(0);",
                    "    form.getForm().findField('ch_kv').setValue(form.getForm().findField('kv').getValue());",
                    "    form.getForm().findField('ch_kvf1').setValue(form.getForm().findField('kvf1').getValue());",
                    "    viborTarif.clearValue();",
                    "    viborTarif.setDisabled(false);",
                    "    if (Ext.Date.format(Ext.Date.getFirstDateOfMonth(selected[0].data.data), 'Y-m-d') ==",
                    "        Ext.Date.format(Ext.Date.getFirstDateOfMonth(form.getForm().findField('data_nach').getValue()), 'Y-m-d')) {",
                    "        btAddNach.setDisabled(false);",
                    "        btAddNachRemont.setDisabled(false);",
                    "        btAddNachDop.setDisabled(false);",
                    "        btAddNachKvPrev.setDisabled(false);",
                    "",
                    "",
                    "        btAddPerer.setDisabled(true);",
                    "        btAddPererNachKv.setDisabled(false);",
                    "        btnInsTarif.setDisabled(false);",
                    "",
                    "",
                    "       ",
                    "    }else{",
                    "        btAddNach.setDisabled(true);",
                    "        btAddNachRemont.setDisabled(true);",
                    "        btAddNachDop.setDisabled(true);",
                    "        btAddNachKvPrev.setDisabled(true);",
                    "",
                    "        btAddPerer.setDisabled(false);",
                    "        btAddPererNachKv.setDisabled(true);",
                    "        viborTarif.setDisabled(true);",
                    "        btnInsTarif.setDisabled(true);",
                    "    }",
                    "    tarif.setValue(0);",
                    "",
                    "",
                    "    stAddress.removeAll();",
                    "    stAddress.load({",
                    "        params: {",
                    "            what:'AddressFromHousesTarif',",
                    "            house_id: selected[0].data.house_id",
                    "        },",
                    "        callback: function(records,operation,success){",
                    "            if(success){",
                    "                form.getForm().findField('address_ot').setValue(records[0].get('address_id'));",
                    "                form.getForm().findField('address_do').setValue(records[0].get('address_id'));",
                    "            }",
                    "",
                    "        },",
                    "        scope:this",
                    "    });",
                    "",
                    "}",
                    ""
                ],
                "name": "selectionchange"
            },
            "name": "onGrTarifHousesKvSelectionChange",
            "designerId": "b76db969-e83b-4596-8d2e-d57f723a284b"
        }
    ]
}